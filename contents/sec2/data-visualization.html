

<!DOCTYPE html>


<html lang="ja" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1. データ可視化と次元圧縮 &#8212; 機械学習発展 (実践)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/custom.js"></script>
    <script src="../../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="application/vnd.jupyter.widget-state+json">{"state": {"24d2de8ba8594b809048fcfaa939d3a7": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_35b8e0fec41f47fd8db5c1b4f9203230", "placeholder": "\u200b", "style": "IPY_MODEL_a3cacd63b63c4ceebd4fa03d9bce3630", "tabbable": null, "tooltip": null, "value": "100%"}}, "2514bfebab864302b883d6a34f8a0a28": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_d453bb8547064640ab4ecd9dfce35a9b", "max": 100.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_4cdd6dafe7534c3caaf515d10e6d1148", "tabbable": null, "tooltip": null, "value": 100.0}}, "34655c45a82b42b2a495d340167fbb81": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "35b8e0fec41f47fd8db5c1b4f9203230": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "4cdd6dafe7534c3caaf515d10e6d1148": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "998443350da34592bc8965ed42227af7": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a3cacd63b63c4ceebd4fa03d9bce3630": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "d453bb8547064640ab4ecd9dfce35a9b": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "df7c9058a0d04174ac82ce43d66c2aad": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_24d2de8ba8594b809048fcfaa939d3a7", "IPY_MODEL_2514bfebab864302b883d6a34f8a0a28", "IPY_MODEL_fc692d44fd4246b790fc3323fec022e6"], "layout": "IPY_MODEL_998443350da34592bc8965ed42227af7", "tabbable": null, "tooltip": null}}, "fa04e9c45f1c46aeb362c77498d9691f": {"model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fc692d44fd4246b790fc3323fec022e6": {"model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_fa04e9c45f1c46aeb362c77498d9691f", "placeholder": "\u200b", "style": "IPY_MODEL_34655c45a82b42b2a495d340167fbb81", "tabbable": null, "tooltip": null, "value": " 100/100 [00:18&lt;00:00,  5.46it/s]"}}}, "version_major": 2, "version_minor": 0}</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contents/sec2/data-visualization';</script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="2. 特徴量抽出" href="feature-extraction.html" />
    <link rel="prev" title="4. 演習1 - 画像入力式数独ソルバーを作る" href="../sec1/exercise-sudoku.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">機械学習発展 (実践)</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">第0部 各種基本ライブラリの使用法</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sec1/setup-python.html">1. Python環境の設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/numpy.html">2. NumPyの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/matplotlib.html">3. Matplotlibの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/pandas.html">4. Pandasの基本</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第1部 画像読み取り式数独ソルバの実装</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sec1/opencv.html">1. OpenCVの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/figure-detection.html">2. 図形の検出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/scikit-learn.html">3. scikit-learnによる機械分類の基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/exercise-sudoku.html">4. 演習1 - 画像入力式数独ソルバーを作る</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第2部 ひらがなOCRソフトと百人一首エージェントの実装</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">1. データ可視化と次元圧縮</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature-extraction.html">2. 特徴量抽出</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep-learning.html">3. 深層学習による物体認識</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise-ogura.html">4. 演習2 - 百人一首エージェントを作る</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第3部 強化学習の基礎とリバーシエージェントの実装</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sec3/reinforcement-learning.html">1. 強化学習の基礎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec3/q-learning.html">2. Q学習の基礎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec3/othello-agent.html">3. オセロAIの作成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec3/deep-reinforcement-learning.html">4. 深層強化学習</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec3/exercise-othello.html">5. 演習3 - オセロエージェントを作る</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/notation.html">資料中の表記について</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/tatsy/1284-sds-ml-advanced/blob/master/./contents/sec2/data-visualization.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tatsy/1284-sds-ml-advanced" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="ソースリポジトリ"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tatsy/1284-sds-ml-advanced/issues/new?title=Issue%20on%20page%20%2Fcontents/sec2/data-visualization.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="問題を報告"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="このページをダウンロード">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/contents/sec2/data-visualization.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="ソースファイルをダウンロード"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="PDFに印刷"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全画面モード"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>データ可視化と次元圧縮</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目次 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.1. 線形の次元圧縮</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca">1.1.1. 主成分分析 (PCA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mds">1.1.2. 多次元尺度構成法 (MDS)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.2. 非線形の次元圧縮</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isomap">1.2.1. ISOMAP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lle">1.2.2. 局所線形埋め込み法 (LLE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">1.2.3. カーネル主成分分析</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mnist">1.3. MNISTの分析</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">1.3.1. データ分布の可視化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">1.3.2. 主成分分析の画像的な意味</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">1.4. 練習問題</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">1.5. 参考文献</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sec-data-visualization">
<span id="id1"></span><h1><span class="section-number">1. </span>データ可視化と次元圧縮<a class="headerlink" href="#sec-data-visualization" title="Permalink to this heading">#</a></h1>
<p>機械学習において、データを扱う際には、データそのものがどのような性質を持っているかをよ事前に調べておくことが有効である。しかし、多くのデータは多次元のデータであるため、そのままデータがどのような分布になっているかを見ることは難しい。</p>
<p>そこで、データを2次元や3次元といった、人間にとって理解のしやすい次元に落として、データの分布の様子を見ることが必要になる。ここで用いるのが<strong>次元圧縮</strong>である。</p>
<p>次元圧縮には<strong>線形</strong>の次元圧縮と<strong>非線形</strong>の次元圧縮があり、線形の手法は、元のデータに何らかの行列を作用させて、低次元のベクトルを得る。それに対し、非線形の手法は元のデータを入力とする多変数関数を定義することで低次元のベクトルを得る。</p>
<p>次元圧縮を考える際、実際のデータは<strong>高次元空間にランダムに存在している訳ではなく、ある程度の規則に従って散らばっている</strong>ことを意識しておくことが大切である。このようなデータの散らばりは、ある程度、高次元空間上の曲面付近での散らばりと見なせることが多い。この曲面の構造をある種の<strong>多様体</strong>であると見なして、低次元空間への埋め込みを行う方法を、特に<strong>多様体学習</strong>と呼ぶ。</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">下準備のコード</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="c1"># 乱数の固定</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">31415</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">31415</span><span class="p">)</span>

<span class="c1"># 一部の警告の無視</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># 実験に用いるサンプル数</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;n_samples&quot;</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># グラフの設定</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>今回は、以下のスイスロールのデータを題材に次元圧縮と可視化の方法について見ていこう。</p>
<p><strong>スイスロールのデータ</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="c1"># データセットの取り出し</span>
<span class="n">X_sr</span><span class="p">,</span> <span class="n">y_sr</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_swiss_roll</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># yの値を正規化して、色情報に変換しておく</span>
<span class="n">y_sr</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_sr</span> <span class="o">-</span> <span class="n">y_sr</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_sr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_sr</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">y_sr</span><span class="p">)</span>

<span class="c1"># 三次元プロットの表示</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">X_sr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Swiss Roll&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/aa25db3f2430b87b4430ffdbcda94e7c4ddd183f65389b174fce242bc3a93ff9.png" src="../../_images/aa25db3f2430b87b4430ffdbcda94e7c4ddd183f65389b174fce242bc3a93ff9.png" />
</div>
</div>
<section id="id2">
<h2><span class="section-number">1.1. </span>線形の次元圧縮<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<section id="pca">
<h3><span class="section-number">1.1.1. </span>主成分分析 (PCA)<a class="headerlink" href="#pca" title="Permalink to this heading">#</a></h3>
<p><strong>主成分分析</strong> (PCA = Principal Component Analysis)は、データの散らばりが大きい方向に沿うように軸を取って次元圧縮を行う方法である。例えば、2次元空間に射影を行う場合、最も分散が大きな方向と次に分散が大きな方向を計算して、その2つの方向を基底ベクトルとして定義される低次元空間への射影を行う。</p>
<p>このようなデータの散らばりの性質を調べるには、データから定まる分散共分散行列を用いる。分散共分散行列はその固有ベクトルが散らばりの方向を、固有値が散らばりの大きさを表わす。</p>
<p>なお、本資料においては、与えられたデータ<span class="math notranslate nohighlight">\(\mathcal{X} = \{ \mathbf{x}_1, \ldots, \mathbf{x}_N \}\)</span>が標本ではなく、全てのデータを代表していると考えて、以下のように平均<span class="math notranslate nohighlight">\(\boldsymbol\mu\)</span>や分散共分散行列<span class="math notranslate nohighlight">\(\mathbf{C}\)</span>を計算する (情報科学の分野では、厳密性を排除して、このように計算することが多い)。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\boldsymbol{\mu} &amp;= \frac{1}{N} \sum_{i=1}^N \mathbf{x}_i \\
\mathbf{C} &amp;= \frac{1}{N} \sum_{i=1}^N (\bar{\mathbf{x}} - \mathbf{x}_i) (\bar{\mathbf{x}} - \mathbf{x}_i)^\top 
\end{aligned}
\end{split}\]</div>
<p>NumPyを用いて、平均と分散共分散行列を計算すると、以下のようになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 分散共分散行列の計算</span>
<span class="n">mu_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X_sr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">C_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">X_sr</span> <span class="o">-</span> <span class="n">mu_sr</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X_sr</span> <span class="o">-</span> <span class="n">mu_sr</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_samples</span>
</pre></div>
</div>
</div>
</div>
<p>分散共分散行列は実対称行列であるので、固有値と固有ベクトルが必ず実数で求まる(実非対称行列の場合には、固有値や固有ベクトルが複素数になることがある)。固有値を求める場合は<code class="docutils literal notranslate"><span class="pre">np.linalg.eig</span></code>ではなく<code class="docutils literal notranslate"><span class="pre">np.linalg.eigh</span></code> (接尾字の<code class="docutils literal notranslate"><span class="pre">h</span></code>はHermiteの意味)を用いると、より効率が良い。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 固有値分解</span>
<span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">C_sr</span><span class="p">)</span>

<span class="c1"># 固有値が大きい順にソートして、先頭の2つを取り出す</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eigval</span><span class="p">))</span>
<span class="n">eigval</span> <span class="o">=</span> <span class="n">eigval</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">eigvec</span> <span class="o">=</span> <span class="n">eigvec</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[:</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># 固有ベクトルの方向にデータを射影する</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">X_sr</span> <span class="o">@</span> <span class="n">eigvec</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Swiss Roll (PCA)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/1a34e96af83838301f3a877e1c8d0ee64957c797ea75cbd5c1025bbb2a396d55.png" src="../../_images/1a34e96af83838301f3a877e1c8d0ee64957c797ea75cbd5c1025bbb2a396d55.png" />
</div>
</div>
<p>スイスロールのデータを二次元空間にPCAで射影してみると、予想通り、データの散らばりが大きなx軸方向とz軸方向を基底ベクトルとするxz平面上に射影されていることが分かる。</p>
<p>なお、PCAをscikit-learnを用いて実行する場合には、以下のようになる。同様に2次元空間で可視化してみると、先ほどと同じ画像が得られていることが確認できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Swiss Roll (scikit-learn, PCA)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/e551c8f0d99106bc46844b55af38276f85b9f947a022b16e62319a1b45ecf384.png" src="../../_images/e551c8f0d99106bc46844b55af38276f85b9f947a022b16e62319a1b45ecf384.png" />
</div>
</div>
</section>
<section id="mds">
<h3><span class="section-number">1.1.2. </span>多次元尺度構成法 (MDS)<a class="headerlink" href="#mds" title="Permalink to this heading">#</a></h3>
<p><strong>多次元尺度構成法</strong>(MDS = Multi-Dimensional Scaling)は距離空間学習法の一種で元の空間における点と点の距離をなるべく保つように低次元空間に点を射影する。今回はデータとデータの間の距離を通常のEuclidノルムで求めて多次元尺度構成法を実行してみる。</p>
<p>多次元尺度構成法では、点と点の間の距離を表わす以下の行列<span class="math notranslate nohighlight">\(\mathbf{D} \in \mathbb{R}^{N \times N}\)</span>を考える。</p>
<div class="math notranslate nohighlight">
\[
D_{ij} = \| \mathbf{x}_i - \mathbf{x}_j \|
\]</div>
<p>低次元空間における<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>のベクトル表現<span class="math notranslate nohighlight">\(\mathbf{z}_i\)</span>は、この距離をできる限り保つように計算される。すなわち、任意の<span class="math notranslate nohighlight">\(\mathbf{z}_i\)</span>と<span class="math notranslate nohighlight">\(\mathbf{z}_j\)</span>の組に対して、</p>
<div class="math notranslate nohighlight" id="equation-eq-z-vs-d">
<span class="eqno">(1.2)<a class="headerlink" href="#equation-eq-z-vs-d" title="この数式へのパーマリンク">#</a></span>\[
\| \mathbf{z}_i - \mathbf{z}_j \| = D_{ij}
\]</div>
<p>となることが求められる。今、多次元尺度構成法では<strong>距離だけを保てば良い</strong>ので、<span class="math notranslate nohighlight">\(\mathbf{x}_1, \ldots, \mathbf{x}_N\)</span>の重心が原点となるように平行移動してある、すなわち、</p>
<div class="math notranslate nohighlight" id="equation-eq-center-is-origin">
<span class="eqno">(1.3)<a class="headerlink" href="#equation-eq-center-is-origin" title="この数式へのパーマリンク">#</a></span>\[
\sum_{i=1}^N \mathbf{x}_i = \mathbf{0}
\]</div>
<p>が成り立つとして、以下の議論を行う。始めに、<a class="reference internal" href="#equation-eq-z-vs-d">(1.2)</a>の両辺を二乗すると、</p>
<div class="math notranslate nohighlight" id="equation-eq-d-square">
<span class="eqno">(1.4)<a class="headerlink" href="#equation-eq-d-square" title="この数式へのパーマリンク">#</a></span>\[
D_{ij}^2 = \| \mathbf{z}_i \|^2 + \| \mathbf{z}_j \|^2 -2 \mathbf{z}_i^\top \mathbf{z}_j
\]</div>
<p>となる。ここでさらに、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
D_{i*} &amp;= \sum_{j=1}^N D_{ij} \\
D_{*j} &amp;= \sum_{i=1}^N D_{ij} \\
D_{**} &amp;= \sum_{i,j} D_{ij} \\
\end{align}
\end{split}\]</div>
<p>のように置くと、これらは、<a class="reference internal" href="#equation-eq-d-square">(1.4)</a>ならび<a class="reference internal" href="#equation-eq-center-is-origin">(1.3)</a>から、以下のように計算できる。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
D_{i*} &amp;= N \| \mathbf{z}_i \|^2 + \sum_{j=1} \| \mathbf{z}_j \|^2 \\
D_{*j} &amp;= \sum_{i=1}^N \| \mathbf{z}_i \|^2 + N \| \mathbf{z}_j \|^2 \\
D_{**} &amp;= 2N \sum_{i=1} \| \mathbf{z}_i \|^2
\end{align}
\end{split}\]</div>
<p>これらの関係式を用いて、<span class="math notranslate nohighlight">\(\| \mathbf{z}_i \|^2\)</span>, <span class="math notranslate nohighlight">\(\| \mathbf{z}_j \|^2\)</span>, ならびに<span class="math notranslate nohighlight">\(\mathbf{z}_i^\top \mathbf{z}_j\)</span>を<span class="math notranslate nohighlight">\(D_{i*}\)</span>, <span class="math notranslate nohighlight">\(D_{*j}\)</span>, ならびに<span class="math notranslate nohighlight">\(D_{**}\)</span>を用いて書き直す。結果だけを示すと以下のようになる。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\| \mathbf{z}_i \|^2 &amp;= \frac{1}{N} D_{*j}^2 - \frac{1}{2N^2} D_{**} \\
\| \mathbf{z}_j \|^2 &amp;= \frac{1}{N} D_{i*}^2 - \frac{1}{2N^2} D_{**} \\
\mathbf{z}_i^\top \mathbf{z}_j &amp;= \frac{1}{2} \left( \frac{1}{N} D_{i*}^2 + \frac{1}{N} D_{*j}^2 - \frac{1}{N^2} D_{**}^2 - D_{ij}^2 \right)
\end{align}
\end{split}\]</div>
<p>最後の式を用いると、<span class="math notranslate nohighlight">\(\mathbf{Z} = [ \mathbf{z}_1 \cdots \mathbf{z}_N ] \in \mathbb{R}^{M \times N}\)</span>に対して、</p>
<div class="math notranslate nohighlight" id="equation-eq-mds">
<span class="eqno">(1.5)<a class="headerlink" href="#equation-eq-mds" title="この数式へのパーマリンク">#</a></span>\[
\mathbf{Z}^\top \mathbf{Z} = -\frac{1}{2} \mathbf{H} \mathbf{D}^2 \mathbf{H}
\]</div>
<p>という式が成り立つ。なお、ここでは、<span class="math notranslate nohighlight">\(\mathbf{D}^2\)</span>は<span class="math notranslate nohighlight">\(\mathbf{D}\)</span>の各要素を二乗したものであるとし、<span class="math notranslate nohighlight">\(\mathbf{H}\)</span>は以下のように定義される。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{H} = \mathbf{I} - \frac{1}{N} \mathbf{1} \mathbf{1}^\top
\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(\mathbf{I}\)</span>は単位行列、<span class="math notranslate nohighlight">\(\mathbf{1}\mathbf{1}^\top\)</span>は全ての要素が1の<span class="math notranslate nohighlight">\(N\times N\)</span>要素を持つ行列であるとする。</p>
<p>今、<a class="reference internal" href="#equation-eq-mds">(1.5)</a>の右辺を<span class="math notranslate nohighlight">\(\mathbf{K}\)</span>と置くこととすると、<span class="math notranslate nohighlight">\(\mathbf{K}\)</span>は半正定値行列であり、<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>の解として、以下が得られる。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{Z} = [ \sqrt{\lambda_1} \mathbf{u}_1 \cdots \sqrt{\lambda_M} \mathbf{u}_M ]^\top
\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(\{ \lambda_i \in \mathbb{R} : i = 1, \ldots, N \}\)</span>は、<span class="math notranslate nohighlight">\(\mathbf{K}\)</span>の固有値を絶対値が大きい順に並べたものであり、<span class="math notranslate nohighlight">\(\{ \mathbf{u}_i \in \mathbb{R}^{N} : i = 1, \ldots, N \}\)</span>は、それに対応する固有ベクトルである。</p>
<hr class="docutils" />
<p>では、以上の議論を元にスイスロールのデータに対して多次元尺度構成法を適用してみる。なお、今回は、固有値分解を行う対象の行列が巨大であるため、SciPyの<code class="docutils literal notranslate"><span class="pre">eigh</span></code>関数を用いて、絶対値が大きい順に先頭から2個だけ固有値と固有ベクトルを求める。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="c1"># 距離行列の計算</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">D_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">X_sr</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">X_sr</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># MDS</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">K_sr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span> <span class="o">@</span> <span class="p">(</span><span class="n">D_sr</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">@</span> <span class="n">H</span><span class="p">)</span>

<span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">K_sr</span><span class="p">,</span> <span class="n">subset_by_index</span><span class="o">=</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">eigval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eigval</span><span class="p">)</span>
<span class="n">eigvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eigvec</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">eigvec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eigval</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Classical MDS&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/e78b6f39e95786baaea30df64a19c552eb00f25896adb26b620e0805337f8351.png" src="../../_images/e78b6f39e95786baaea30df64a19c552eb00f25896adb26b620e0805337f8351.png" />
</div>
</div>
<p>この多次元尺度構成法の結果は、定義式から分かるとおり、元のベクトルを線形に射影した物であり、元々のスイスロールのデータをとある方向 (元の空間での距離が最大限保たれる方向)から見たものと等価である。従って、主成分分析と比べて、ややスイスロールの帯の部分に拡がりのあるデータとなっているものの、全体の見た目としてはそれほど変わりがないことが分かる。</p>
<p>一方で、MDSにはデータの間の距離を調整するSMACOF(Scaling by MAjorizing a COmplicated Function)というテクニック<span id="id3">[<a class="reference internal" href="#id24" title="De Leeuw. Application of convex analysis to multidimensional scaling. Recent Developments in Statistics, pages 133–145, 1977.">Leeuw, 1977</a>]</span>が知られている。SMACOFは、<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>をランダムに初期化した状態からスタートし、<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>から求まる距離行列<span class="math notranslate nohighlight">\(\mathbf{D}'\)</span>が目的の距離行列<span class="math notranslate nohighlight">\(\mathbf{D}\)</span>に近づくように、Guttman変換と呼ばれる変換を用いて<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>を更新していく。これにより、元の多次元尺度構成法とは異なった非線形変換による低次元空間表現を得ることができ、低次元空間でのデータ<span class="math notranslate nohighlight">\(\{ \mathbf{z}_1, \ldots, \mathbf{z}_N\}\)</span>の配置が、より元の空間での距離を反映した物にすることができる。</p>
<p>SMACOFでは<strong>ストレス</strong> <span class="math notranslate nohighlight">\(S\)</span>と<strong>比率行列</strong> <span class="math notranslate nohighlight">\(R\)</span>を、現在の<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>から求まる距離行列<span class="math notranslate nohighlight">\(\mathbf{D}'\)</span>を用いて以下のように定義する。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
S &amp;= \frac{1}{2} \| \mathbf{D}' - \mathbf{D} \|_F \\
\mathbf{R} &amp;= (D_{ij} / (D'_{ij} + \varepsilon))_{ij}
\end{align}
\end{split}\]</div>
<p>と定義する。なお、ここで<span class="math notranslate nohighlight">\(\varepsilon\)</span>はゼロ除算を防ぐための微小な実数、<span class="math notranslate nohighlight">\(( m(i, j) )_{ij}\)</span>は<span class="math notranslate nohighlight">\(i\)</span>行<span class="math notranslate nohighlight">\(j\)</span>列の要素が<span class="math notranslate nohighlight">\(m(i, j)\)</span>であるような行列を表すとする。ここで<span class="math notranslate nohighlight">\(\mathbf{R}\)</span>からGuttman変換 <span class="math notranslate nohighlight">\(\mathbf{B} \in \mathbb{R}^{N \times N}\)</span>を次のように定義する。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{B} = \frac{1}{N} \left( \text{diag}_i \left( \sum_{k=1}^N R_{ik} \right) - \mathbf{R} \right)
\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(\text{diag}_i ( m(i) )\)</span>は<span class="math notranslate nohighlight">\(m(i)\)</span>を<span class="math notranslate nohighlight">\(i\)</span>番目の対角要素とするような対角行列であるとする。この<span class="math notranslate nohighlight">\(\mathbf{B}\)</span>を用いて、次のように<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>を更新する。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{Z}_{\rm new} = \mathbf{B} \mathbf{Z}
\]</div>
<p>この式は、ストレス<span class="math notranslate nohighlight">\(S\)</span>を最急降下法により最小化する場合の更新ルールに対応しており、この変換を繰り返すことで、ストレス、即ち低次元空間表現から求まる距離行列と、目的の距離行列の相対フロベニウスノルムを最小化することができる。</p>
<hr class="docutils" />
<p>上記のSMACOFの数式をコードに落とすと以下のようになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># SMACOFのパラメータ</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0e-6</span>
<span class="n">max_iter</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Zおよびストレスの初期化</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<span class="n">old_stress</span> <span class="o">=</span> <span class="mf">1.0e20</span>

<span class="c1"># SMACOF iterations</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)):</span>
    <span class="c1"># Zから距離行列を計算</span>
    <span class="n">D_sr_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_sr</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Guttman transformによるZの更新</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">D_sr</span> <span class="o">/</span> <span class="p">(</span><span class="n">D_sr_prime</span> <span class="o">+</span> <span class="mf">1.0e-5</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">ratio</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">z_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">z_sr</span><span class="p">)</span>

    <span class="c1"># ストレスの計算</span>
    <span class="n">stress</span> <span class="o">=</span> <span class="p">((</span><span class="n">D_sr_prime</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">-</span> <span class="n">D_sr</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">rel_stress</span> <span class="o">=</span> <span class="n">stress</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">z_sr</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># ストレスの変化が一定以下になったら処理を終了</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">old_stress</span> <span class="o">-</span> <span class="n">rel_stress</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">old_stress</span> <span class="o">=</span> <span class="n">rel_stress</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "df7c9058a0d04174ac82ce43d66c2aad", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;MDS with SMACOF&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/8a47dab25c709065423b46e5e6d8b0beafe7d4f1903ddbfd5c3924507674d1b2.png" src="../../_images/8a47dab25c709065423b46e5e6d8b0beafe7d4f1903ddbfd5c3924507674d1b2.png" />
</div>
</div>
<p>すると、先ほどのSMACOFを用いない多次元尺度構成法と比べて、よりスイスロールの帯が広がったような結果となっていることが確認でき、SMACOFにより、観測空間におけるデータ間の距離がより保存される形で次元圧縮できていることが分かる。</p>
<p>このSMACOFを用いた実装はscikit-learnでのデフォルト実装となっており、上記と同様の結果は、scikit-learnにより以下のコードで得ることができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">MDS</span>

<span class="c1"># 距離行列が求まっている場合には「dissimilarity=&quot;precomputed&quot;」を指定する</span>
<span class="n">mds</span> <span class="o">=</span> <span class="n">MDS</span><span class="p">(</span>
    <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">dissimilarity</span><span class="o">=</span><span class="s2">&quot;precomputed&quot;</span><span class="p">,</span>
    <span class="n">n_init</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">normalized_stress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">mds</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">D_sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;MDS with SMACOF (scikit-learn)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/61d8087698f2484c52a401b46d36a33ba8c3362dc8f7202a92994da444431487.png" src="../../_images/61d8087698f2484c52a401b46d36a33ba8c3362dc8f7202a92994da444431487.png" />
</div>
</div>
</section>
</section>
<section id="id4">
<h2><span class="section-number">1.2. </span>非線形の次元圧縮<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<section id="isomap">
<h3><span class="section-number">1.2.1. </span>ISOMAP<a class="headerlink" href="#isomap" title="Permalink to this heading">#</a></h3>
<p><strong>ISOMAP</strong>は多次元尺度構成法の拡張の一種で、<strong>データ間の距離の計算にk-nearest neighbor graph (kNNグラフ)上で計算された測地距離</strong>を用いる。なお、kNNグラフとは、各点とその近傍を結んで作られるグラフ構造を指す。このようなグラフを作成するために、以下のコードでは <a class="reference external" href="https://en.wikipedia.org/wiki/K-d_tree">KD木</a>を用いた最近某探索を用いる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="c1"># 各データ点に対する最近傍点の探索</span>
<span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">kd_tree</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;kd_tree&quot;</span><span class="p">)</span>
<span class="n">kd_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">kd_tree</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>

<span class="c1"># 自分自身までの距離を除去</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>ここで<code class="docutils literal notranslate"><span class="pre">distances</span></code>と<code class="docutils literal notranslate"><span class="pre">indices</span></code>は<code class="docutils literal notranslate"><span class="pre">[1000,</span> <span class="pre">5]</span></code>の大きさのデータになっていて、各頂点に対する近傍点までの距離と、近傍点のインデックスが入っている。なお、探索元のデータ群と探索先のデータ群を同じにすると、<code class="docutils literal notranslate"><span class="pre">distances[:,</span> <span class="pre">0]</span></code>が自分自身の点までの距離で0となってしまうため、kNNグラフを作る際には、このようなデータを除去しておく。</p>
<p>次にグラフ計算のためのライブラリである<code class="docutils literal notranslate"><span class="pre">networkx</span></code>を用いて、グラフ上での点と点の距離を計算する。まずはグラフの作成。<code class="docutils literal notranslate"><span class="pre">networkx</span></code>でグラフを作成するためには<code class="docutils literal notranslate"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">{&quot;weight&quot;:</span> <span class="pre">1.0})</span></code>のような辺の端点を表わす点のインデックス<code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">j</span></code>と、辺に対する重みの除法を表わす<code class="docutils literal notranslate"><span class="pre">{&quot;weight&quot;:</span> <span class="pre">1.0}</span></code>を辺の数分だけ配列に格納し、その配列を用いて <code class="docutils literal notranslate"><span class="pre">from_edgelist</span></code> からグラフを作成する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># kNNグラフの作成</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="c1"># 辺のデータの収集</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_neighbors</span><span class="p">):</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]}))</span>
        <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]}))</span>

<span class="c1"># グラフの作成</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_edgelist</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>グラフが作成できたら、<a class="reference external" href="https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm">Warshall-Floyd法</a>によって、全点対間の距離を計算する。なお、Warshall-Floyd法はグラフの頂点数 <span class="math notranslate nohighlight">\(N\)</span>に対して <span class="math notranslate nohighlight">\(O(N^3)\)</span>のアルゴリズムなので、計算量に注意すること。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Warshall-Floyd法による全点対間距離の計算</span>
<span class="c1"># 注意: networkxのグラフのノードはインデックス順になっていないので、第2引数にノード順を指定する</span>
<span class="n">D_sr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">floyd_warshall_numpy</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>ここまででkNNグラフ上での頂点間距離が求まったので、この距離行列を用いて多次元尺度構成法と同様の計算を行う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">K</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span> <span class="o">@</span> <span class="p">(</span><span class="n">D_sr</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">@</span> <span class="n">H</span><span class="p">)</span>

<span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">subset_by_index</span><span class="o">=</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">eigval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eigval</span><span class="p">)</span>
<span class="n">eigvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eigvec</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">z_sr</span> <span class="o">=</span> <span class="n">eigvec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigval</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ISOMAP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/4746e4bda410855cd241b6daa1cbc77e09dd60ba78e0b1672aeecdc41c9d2450.png" src="../../_images/4746e4bda410855cd241b6daa1cbc77e09dd60ba78e0b1672aeecdc41c9d2450.png" />
</div>
</div>
<p>ここまでと同様の結果は、scikit-learnの<code class="docutils literal notranslate"><span class="pre">Isomap</span></code>でも得ることができる。<code class="docutils literal notranslate"><span class="pre">Isomap</span></code>はパラメータにkNNグラフを作成するためのアルゴリズム<code class="docutils literal notranslate"><span class="pre">neighbors_algorith</span></code>と、グラフ上の距離を計算するためのアルゴリズム<code class="docutils literal notranslate"><span class="pre">path_method</span></code>を取る。今回は、上記のコードに合わせて<code class="docutils literal notranslate"><span class="pre">&quot;kd_tree&quot;</span></code>と<code class="docutils literal notranslate"><span class="pre">&quot;FW&quot;</span></code> (Floyd-Warshallの頭文字)を指定してある。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">Isomap</span>

<span class="n">isomap</span> <span class="o">=</span> <span class="n">Isomap</span><span class="p">(</span>
    <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">neighbors_algorithm</span><span class="o">=</span><span class="s2">&quot;kd_tree&quot;</span><span class="p">,</span>
    <span class="n">path_method</span><span class="o">=</span><span class="s2">&quot;FW&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">isomap</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ISOMAP (scikit-learn)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/3e8622ff568dd418aa25c8a9ba032d6d072530eb15555c33901d084136e36e08.png" src="../../_images/3e8622ff568dd418aa25c8a9ba032d6d072530eb15555c33901d084136e36e08.png" />
</div>
</div>
</section>
<section id="lle">
<h3><span class="section-number">1.2.2. </span>局所線形埋め込み法 (LLE)<a class="headerlink" href="#lle" title="Permalink to this heading">#</a></h3>
<p><strong>局所線形埋め込み法</strong> (LLE = Locally Linear Embedding) <span id="id5">[<a class="reference internal" href="#id25" title="Sam T. Roweis and Lawrence K. Saul. Nonlinear dimensionality reduction by locally linear embedding. Science, 290(5500):2323–2326, dec 2000. doi:10.1126/science.290.5500.2323.">Roweis and Saul, 2000</a>]</span>は、その名前が示す通り、高次元空間上の点である<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>とその近傍において、線形性を保存するように低次元空間での表現を得る次元圧縮法である。</p>
<p>今、<span class="math notranslate nohighlight">\(\mathbf{x}_i \in \mathbb{R}^D\)</span>の近傍点として、<span class="math notranslate nohighlight">\(\mathbf{x}_{i_1}, \ldots, \mathbf{x}_{i_K}\)</span>が与えられたとしよう。ここでいう線形性とは、<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>が近傍点の凸結合として、以下のように表せることを意味する。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{x}_i = \sum_{k=1}^K w_{ik} \mathbf{x}_{i_k}, \quad \forall i, \forall k, ~~ w_{ik} \geq 0, ~~ \sum_{k=1}^K w_{ik} = 1
\]</div>
<p>この式に対して<span class="math notranslate nohighlight">\(\mathbf{d}_{i_k} = \mathbf{x}_{i_k} - \mathbf{x}_i\)</span>とおいて、<span class="math notranslate nohighlight">\(\mathbf{D}_i = [ \mathbf{d}_{i_1} \cdots \mathbf{d}_{i_K} ] \in \mathbb{R}^{K \times D}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{w}_i = (w_{i1} \cdots w_{iK})^\top \in \mathbb{R}^K\)</span>と置くことで、以下のように書き直せる。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{D}_i^\top \mathbf{w}_i = \mathbf{0}
\]</div>
<p>これを用いると、解くべき最適化問題は次のようになることが分かる。</p>
<div class="math notranslate nohighlight" id="equation-eq-lle-weight-derivation">
<span class="eqno">(1.6)<a class="headerlink" href="#equation-eq-lle-weight-derivation" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
&amp; \underset{\mathbf{w}_i}{\text{minimize:}} \quad \frac{1}{2} \| \mathbf{D}_i^\top \mathbf{w}_i \|^2 \\
&amp;\begin{aligned}
    \text{subject to:} \quad &amp; \mathbf{1}^\top \mathbf{w}_i = 1 &amp; \\
    &amp; w_{ik} \geq 0 &amp; (i = 1, \ldots, K)
\end{aligned}
\end{align}
\end{split}\]</div>
<p>この最適化問題は不等式制約を含むため、目的関数が二次、制約条件が一次であるものの、単純な線形問題には帰着されない。具体的にはKarush-Kuhn-Tucker条件 (KKT条件)を満たすように、以下のラグランジアンに関する制約付き最適化問題を解く必要がある。</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}(\mathbf{w}_i, \beta, \boldsymbol\mu) = \frac{1}{2} \| \mathbf{D}_i^\top \mathbf{w}_i \|^2 - \lambda (\mathbf{1}^\top \mathbf{w}_i - 1) - \sum_{k=1}^K \mu_k w_{ik}
\]</div>
<p>このラグランジアンを用いると、<a class="reference internal" href="#equation-eq-lle-weight-derivation">(1.6)</a>のKKT条件は以下のように書ける。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\nabla \mathcal{L} = \mathbf{0}, &amp; &amp;\\
w_{ik} \geq 0, &amp; &amp; k = 1, \ldots, K \\
\mu_k w_{ik} = 0, &amp; &amp; k = 1, \ldots, K \\
\mu_k \geq 0, &amp; &amp; k = 1, \ldots, K
\end{align}
\end{split}\]</div>
<p>すると、ラグランジアンの勾配が<span class="math notranslate nohighlight">\(\mathbf{0}\)</span>になるという条件から、</p>
<div class="math notranslate nohighlight">
\[
\mathbf{D}_i \mathbf{D}_i^\top \mathbf{w}_i = \lambda \mathbf{1} + \boldsymbol\mu
\]</div>
<p>となることが分かる。この時、行列 <span class="math notranslate nohighlight">\(\mathbf{D}_i \mathbf{D}_i^\top\)</span>が半正定値行列であることを考慮すると、両辺に左側から<span class="math notranslate nohighlight">\(\mathbf{w}_i^\top\)</span>を書けることにより、以下の不等式が得られる。</p>
<div class="math notranslate nohighlight">
\[
\lambda \mathbf{1}^\top \mathbf{w}_i + \boldsymbol\mu^\top \mathbf{w}_i = \mathbf{w}_i (\mathbf{D}_i \mathbf{D}_i^\top) \mathbf{w}_i \geq 0
\]</div>
<p>KKT条件より任意の<span class="math notranslate nohighlight">\(k\)</span>について<span class="math notranslate nohighlight">\(\mu_k w_{ik} = 0\)</span>であるので、結局、以下のように書ける。</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2} \| \mathbf{D}_i^\top \mathbf{w}_i \|^2 = \frac{1}{2} \mathbf{w}_i (\mathbf{D}_i \mathbf{D}_i^\top) \mathbf{w}_i \geq \frac{1}{2} \lambda \mathbf{1}^\top \mathbf{w}_i
\]</div>
<p>以上より、<a class="reference internal" href="#equation-eq-lle-weight-derivation">(1.6)</a>を満たすように<span class="math notranslate nohighlight">\(\frac{1}{2} \| \mathbf{D}_i^\top \mathbf{z}_i \|^2\)</span>を最小化するとき、その最小値は<span class="math notranslate nohighlight">\(\frac{1}{2} \lambda \mathbf{1}^\top \mathbf{w}_i\)</span>になることが分かる。</p>
<p>よって、その時の<span class="math notranslate nohighlight">\(\mathbf{w}_i\)</span>を求めるためには、等式を満たす場合に関して、両辺を<span class="math notranslate nohighlight">\(\mathbf{w}_i\)</span>で微分することにより得られる以下の線形方程式を解けば良い。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{D}_i \mathbf{D}_i^\top \mathbf{w}_i = \frac{1}{2} \lambda \mathbf{1}
\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\lambda\)</span>が未知であったことを考慮し、以下のように問題を書き換える。</p>
<div class="math notranslate nohighlight">
\[
\mathbf{D}_i \mathbf{D}_i^\top \mathbf{w}'_i = \mathbf{1}
\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(\mathbf{w}'_i = \frac{2}{\lambda} \mathbf{w}_i\)</span>とする。今、この線形方程式を解いて<span class="math notranslate nohighlight">\(\mathbf{w}'_i\)</span>が求まれば、<span class="math notranslate nohighlight">\(w_{ik}\)</span>の和が1であったことから、</p>
<div class="math notranslate nohighlight">
\[
\mathbf{w}_i = \frac{{w}'_i}{\sum w'_{ik}}
\]</div>
<p>と書ける。これで、とある頂点<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>について、その近傍から<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>を凸結合により表現するための重み<span class="math notranslate nohighlight">\(w_{ik}\)</span>を求めることができた。</p>
<hr class="docutils" />
<p>局所線形埋め込みにおいては<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>に対応する低次元空間表現<span class="math notranslate nohighlight">\(\mathbf{z}_i \in \mathbb{R}^d ~ (d \leq D)\)</span>が同じ局所線形性を有することを仮定する。即ち、</p>
<div class="math notranslate nohighlight">
\[
\mathbf{z}_i = \sum_{k=1}^K w_{ik} \mathbf{z}_{i_k}, \quad \forall i, \forall k, ~~ w_{ik} \geq 0, ~~ \sum_{k=1}^K w_{ik} = 1
\]</div>
<p>が成立すると仮定する。これを全てのデータ点に対して考慮すれば、解くべき問題は以下の二乗誤差の最小化に帰着される。</p>
<div class="math notranslate nohighlight" id="equation-eq-lle-quadratic-form">
<span class="eqno">(1.7)<a class="headerlink" href="#equation-eq-lle-quadratic-form" title="この数式へのパーマリンク">#</a></span>\[
\sum_{i=1}^N \left\| \mathbf{z}_i - \sum_{k=1} w_{ik} \mathbf{z}_{i_k} \right\|^2 = \mathbf{z}^\top (\mathbf{I} - \mathbf{W})^\top (\mathbf{I} - \mathbf{W}) \mathbf{z}
\]</div>
<p>ただし、行列<span class="math notranslate nohighlight">\(\mathbf{W}\)</span>は、その<span class="math notranslate nohighlight">\(i\)</span>行において<span class="math notranslate nohighlight">\(i_1, \ldots, i_K\)</span>列の成分だけが非零の値を持つような疎行列、<span class="math notranslate nohighlight">\(\mathbf{Z} = [ \mathbf{z}_i \cdots \mathbf{z}_N ]^\top \in \mathbb{R}^{N\times d}\)</span>である。</p>
<p>{eq}`(eq:lle-quadratic-form) は、行列 <span class="math notranslate nohighlight">\(\mathbf{M} = (\mathbf{I} - \mathbf{W})^\top (\mathbf{I} - \mathbf{W})\)</span>の二次形式なので、これを最小化するためには、<span class="math notranslate nohighlight">\(\mathbf{z}\)</span>を<span class="math notranslate nohighlight">\(\mathbf{M}\)</span>の固有値の絶対値が小さい順に、固有ベクトルを並べて、</p>
<div class="math notranslate nohighlight">
\[
\mathbf{z} = [\mathbf{u}_2 \cdots \mathbf{u}_{d+1}]
\]</div>
<p>とすれば良いことが分かる。ただし、<span class="math notranslate nohighlight">\(\mathbf{M}\)</span>は半正定値行列で、絶対値最小の固有値<span class="math notranslate nohighlight">\(\lambda_1 = 0\)</span>であるため、これに対応する固有ベクトル<span class="math notranslate nohighlight">\(\mathbf{u}_1\)</span>を除いて、先頭から<span class="math notranslate nohighlight">\(d\)</span>個を並べている。</p>
<p>以上の計算により、局所線形埋め込み法による低次元空間表現が得られた。</p>
<hr class="docutils" />
<p>以上を踏まえて、局所線形埋め込み法のコードを書いてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 各データ点に対する最近傍点の探索</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">kd_tree</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;kd_tree&quot;</span><span class="p">)</span>
<span class="n">kd_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">kd_tree</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>

<span class="c1"># 自分自身までの距離を除去</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 各データ点における重心結合の係数を計算</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ws</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">X_knn</span> <span class="o">=</span> <span class="n">X_sr</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">X_knn</span> <span class="o">=</span> <span class="n">X_knn</span> <span class="o">-</span> <span class="n">X_sr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># 線形問題の計算</span>
    <span class="n">AA</span> <span class="o">=</span> <span class="n">X_knn</span> <span class="o">@</span> <span class="n">X_knn</span><span class="o">.</span><span class="n">T</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tr</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">eps</span> <span class="o">*=</span> <span class="n">tr</span>

    <span class="n">AA</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">AA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">eps</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_neighbors</span><span class="p">))</span>
    <span class="n">w_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">AA</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span>

    <span class="c1"># w_iを要素の合計が1になるように正規化</span>
    <span class="n">w_i</span> <span class="o">=</span> <span class="n">w_i</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w_i</span><span class="p">)</span>

    <span class="n">rows</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_neighbors</span><span class="p">)</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">w_i</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.sparse</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">ws</span><span class="p">,</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">dia_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">W</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;LM&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigval</span><span class="p">))</span>
<span class="n">eigvec</span> <span class="o">=</span> <span class="n">eigvec</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">eigvec</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;LLE&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3aee567af2f92a7f5931bf3e1e13935ed349212768c6dec1e24399384af8f86f.png" src="../../_images/3aee567af2f92a7f5931bf3e1e13935ed349212768c6dec1e24399384af8f86f.png" />
</div>
</div>
<p>以上のように、局所線形埋め込みを用いることで、スイスロールの巻き込み形状を、ISOMAP同様、シート状に伸ばすことができた。</p>
<p>上記と同様の結果はscikit-learnを用いて、以下のコードで得ることができる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">LocallyLinearEmbedding</span>

<span class="n">lle</span> <span class="o">=</span> <span class="n">LocallyLinearEmbedding</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">lle</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;LLE (scikit-learn)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/e6cbdcd4716c7dd0195302871af965b9c1543fe57650fad2b469047d42e41932.png" src="../../_images/e6cbdcd4716c7dd0195302871af965b9c1543fe57650fad2b469047d42e41932.png" />
</div>
</div>
<p>局所線形埋め込み法には、その発展形として、改良局所線形埋め込み法 (Modified LLE) <span id="id6">[<a class="reference internal" href="#id26" title="Zhenyue Zhang and Jing Wang. Mlle: modified locally linear embedding using multiple weights. In B. Schölkopf, J. Platt, and T. Hoffman, editors, Advances in Neural Information Processing Systems, volume 19. MIT Press, 2006. URL: https://proceedings.neurips.cc/paper_files/paper/2006/file/fb2606a5068901da92473666256e6e5b-Paper.pdf.">Zhang and Wang, 2006</a>]</span> やHessian Eigenmap <span id="id7">[<a class="reference internal" href="#id27" title="David L Donoho and Carrie Grimes. Hessian eigenmaps: locally linear embedding techniques for high-dimensional data. Proceedings of the National Academy of Sciences, 100(10):5591–5596, 2003.">Donoho and Grimes, 2003</a>]</span> などがある。興味のある読者は是非、原論文を当たってみてほしい。</p>
</section>
<section id="id8">
<h3><span class="section-number">1.2.3. </span>カーネル主成分分析<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<p><strong>カーネル主成分分析</strong>は<a class="reference internal" href="../sec1/scikit-learn.html#ssec-support-vector-machine"><span class="std std-ref">サポートベクトルマシン</span></a>の項で紹介したカーネル法を用いた主成分分析の拡張である。カーネル法では、与えられたデータ<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>をとある線形汎関数<span class="math notranslate nohighlight">\(\phi \in \mathcal{H}\)</span>を用いて、<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i)\)</span>のように変換する。カーネル主成分分析はこの<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i)\)</span>に対して主成分分析を行う手法である。</p>
<p>今、仮に<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i)\)</span>の平均が原点にあると仮定すると、その分散共分散行列<span class="math notranslate nohighlight">\(C: \mathcal{H} \mapsto \mathcal{H}\)</span>は次のように書ける (今、<span class="math notranslate nohighlight">\(\phi\)</span>が線形汎関数であるので、分散共分散行列がヒルベルト空間<span class="math notranslate nohighlight">\(\mathcal{H}\)</span>上の線形演算子になっていることに注意)。</p>
<div class="math notranslate nohighlight" id="equation-eq-kpca-covariance">
<span class="eqno">(1.8)<a class="headerlink" href="#equation-eq-kpca-covariance" title="この数式へのパーマリンク">#</a></span>\[
C(u, v) = \frac{1}{N} \sum_{i=1}^N \phi(\mathbf{x}_i)(u) \phi(\mathbf{x}_i)(v)
\]</div>
<p>しかし、一般に関数<span class="math notranslate nohighlight">\(\phi\)</span>は未知であり、<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i)\)</span>がどのような形になるかを知ることはできない。そこで、<span class="math notranslate nohighlight">\(C\)</span>を陽に求める代わりに、カーネル法を用いて、主成分分析の結果だけを求めることを試みる。</p>
<p>まずは、主成分分析の見方について再考する。主成分分析は、分散共分散行列の固有ベクトルを求めて、その方向を基底とする部分空間にデータを射影するのであった。</p>
<p>この時、固有ベクトルの方向はデータ分散が大きくなる方向であったことを思いだしてほしい。従って、とあるベクトルの集合<span class="math notranslate nohighlight">\(\mathbf{x}_1, \ldots, \mathbf{x}_N\)</span>について、第一主方向を求める問題は、<strong>とある単位ベクトル<span class="math notranslate nohighlight">\(\mathbf{w}, \| \mathbf{w} \| = 1\)</span>について、<span class="math notranslate nohighlight">\(\mathbf{w}^\top \mathbf{x}_i\)</span>の分散を最大化する問題</strong>に他ならない。</p>
<p>今、<span class="math notranslate nohighlight">\(\mathbf{x}_i\)</span>のサンプル平均を<span class="math notranslate nohighlight">\(\boldsymbol\mu\)</span>とすると、<span class="math notranslate nohighlight">\(\mathbf{w}\)</span>に沿った分散<span class="math notranslate nohighlight">\(V\)</span>は以下のように書ける。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
V
&amp;= \frac{1}{N} \sum_{i=1}^N (\mathbf{w}^\top (\mathbf{x}_i - \boldsymbol\mu))^2 \\
&amp;= \mathbf{w}^\top \left( \frac{1}{N} \sum_{i=1}^N (\mathbf{x}_i - \boldsymbol\mu) (\mathbf{x}_i - \boldsymbol\mu)^\top \right) \mathbf{w}
\end{align}
\end{split}\]</div>
<p>最後の式の<strong>大括弧の中身は分散共分散行列に他ならない</strong>。主成分方向が分散共分散行列の固有ベクトルによって与えられるのは、この式を最大化しているためである。</p>
<hr class="docutils" />
<p>次に、これを<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i), i = 1, \ldots, N\)</span>を考え、その平均を関数<span class="math notranslate nohighlight">\(\mu \in \mathcal{H}\)</span>で表わす。とある線形汎関数<span class="math notranslate nohighlight">\(\psi \in \mathcal{H}\)</span>の方向に沿った分散<span class="math notranslate nohighlight">\(V\)</span>は</p>
<div class="math notranslate nohighlight" id="equation-eq-kpca-variance">
<span class="eqno">(1.9)<a class="headerlink" href="#equation-eq-kpca-variance" title="この数式へのパーマリンク">#</a></span>\[
V = \frac{1}{N} \sum_{i=1}^N \langle \psi, \phi(\mathbf{x}_i) - \mu \rangle^2, \quad \mu = \frac{1}{N} \sum_{i=1}^N \phi(\mathbf{x}_i)
\]</div>
<p>のように書ける。ただし <span class="math notranslate nohighlight">\(\| \psi \|^2 = \langle \psi, \psi \rangle = 1\)</span>である。この分散の値を考える場合、<span class="math notranslate nohighlight">\(\psi\)</span>と内積を取る相手は<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i) - \mu\)</span>に限定されているため、</p>
<div class="math notranslate nohighlight" id="equation-eq-kpca-psi">
<span class="eqno">(1.10)<a class="headerlink" href="#equation-eq-kpca-psi" title="この数式へのパーマリンク">#</a></span>\[
\psi = \sum_{j=1}^N \alpha_j (\phi(\mathbf{x}_j) - \mu)
\]</div>
<p>のように表わしても、内積の値は変化せず、故に分散の値も変化しない (三次元空間において、内積を取る相手のベクトルがとある平面内にしか存在しない場合を考えるとイメージがつきやすい)。</p>
<p><a class="reference internal" href="#equation-eq-kpca-psi">(1.10)</a>を<a class="reference internal" href="#equation-eq-kpca-variance">(1.9)</a>に代入し、更に<span class="math notranslate nohighlight">\(k(\mathbf{x}_i, \mathbf{x}_j) = \langle \phi(\mathbf{x}_i, \mathbf{x}_j)\)</span>の性質を用いると、分散<span class="math notranslate nohighlight">\(V\)</span>は次のように書き直せる。</p>
<div class="math notranslate nohighlight" id="equation-eq-kpca-quadratic">
<span class="eqno">(1.11)<a class="headerlink" href="#equation-eq-kpca-quadratic" title="この数式へのパーマリンク">#</a></span>\[
\begin{equation}
V = \frac{1}{N} \sum_{i=1}^N \sum_{j=1}^N \alpha_j \langle \phi(\mathbf{x}_i) - \mu, \phi(\mathbf{x}_j) - \mu \rangle^2
\end{equation}
\]</div>
<p>このとき、</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\langle \phi(\mathbf{x}_i) - \mu, \phi(\mathbf{x}_j) - \mu \rangle
&amp;= k(\mathbf{x}_i, \mathbf{x}_j) + \frac{1}{N} \sum_{i=1}^N k(\mathbf{x}_i, \mathbf{x}_j) + \frac{1}{N} \sum_{j=1}^N k(\mathbf{x}_i, \mathbf{x}_j) + \frac{1}{N^2} \sum_{i=1}^N \sum_{j=1}^N k(\mathbf{x}_i, \mathbf{x}_j)
\end{align}
\]</div>
<p>となる。カーネル行列<span class="math notranslate nohighlight">\(\mathbf{K}\)</span>を<span class="math notranslate nohighlight">\(K_{ij} = k(\mathbf{x}_i, \mathbf{x}_j)\)</span>となるように定め、さらに、</p>
<div class="math notranslate nohighlight">
\[
\mathbf{H} = \mathbf{I} - \frac{1}{N} \mathbf{1} \mathbf{1}^\top
\]</div>
<p>とおくと、<a class="reference internal" href="#equation-eq-kpca-quadratic">(1.11)</a>は以下のように書き直せる。</p>
<div class="math notranslate nohighlight">
\[
V = \boldsymbol\alpha^\top (\mathbf{H} \mathbf{K} \mathbf{H})^2 \boldsymbol\alpha
\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(\boldsymbol\alpha = (\alpha_1, \ldots, \alpha_N)^\top\)</span>である。以上より、分散を最大化させるような<span class="math notranslate nohighlight">\(\psi\)</span>を与える係数<span class="math notranslate nohighlight">\(\boldsymbol\alpha\)</span>は<span class="math notranslate nohighlight">\(\mathbf{H}\mathbf{K}\mathbf{H}\)</span>に対して、固有値の絶対値が大きい順に固有ベクトルをいくつか取ることで、カーネル主成分分析における主成分方向を得ることができる。</p>
<p>この時、<span class="math notranslate nohighlight">\(\boldsymbol\alpha\)</span>は固有ベクトルから求まるが、実際には、固有ベクトルに定数倍の曖昧さが存在するため、固有ベクトル<span class="math notranslate nohighlight">\(\mathbf{u}\)</span>をそのまま<span class="math notranslate nohighlight">\(\boldsymbol\alpha\)</span>として用いても <span class="math notranslate nohighlight">\(\| \psi \| = 1\)</span>とはならない。</p>
<p>そこで、<span class="math notranslate nohighlight">\(\boldsymbol\alpha = t \mathbf{u}, \| \mathbf{u} \| = 1\)</span>であるとして、<span class="math notranslate nohighlight">\(\| \psi \|^2 = \langle \psi, \psi \rangle\)</span>を求めて、その大きさで正規化する。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\langle \psi, \psi \rangle &amp;= \sum_{i=1}^N \sum_{j=1}^N t u_i t u_j \langle \phi(\mathbf{x}_i) - \mu, \phi(\mathbf{x}_j) - \mu \rangle \\
&amp;= t^2 \mathbf{u}^\top \left( \mathbf{H K H} \right) \mathbf{u}　\\
&amp;= t^2 \lambda = 1
\end{align}
\end{split}\]</div>
<p>従って、<span class="math notranslate nohighlight">\(\psi\)</span>を与える係数<span class="math notranslate nohighlight">\(\boldsymbol\alpha\)</span>は<span class="math notranslate nohighlight">\(\mathbf{H K H}\)</span>の固有値<span class="math notranslate nohighlight">\(\lambda\)</span>と固有ベクトル<span class="math notranslate nohighlight">\(\mathbf{u}\)</span>を用いて、</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol\alpha = \frac{\mathbf{u}}{\sqrt{\lambda}}
\]</div>
<p>となる。</p>
<p>ここで、とある<span class="math notranslate nohighlight">\(\phi(\mathbf{x}_i)\)</span>の主成分分析による低次元表現<span class="math notranslate nohighlight">\(\mathbf{z}_i\)</span>を計算すると、その第<span class="math notranslate nohighlight">\(j\)</span>成分は固有関数<span class="math notranslate nohighlight">\(\psi_j\)</span>を用いて、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
z_{ij} &amp;= \langle \psi_j, \phi(\mathbf{x}_i) - \mu \rangle \\
&amp;= \sum_{k=1}^N \alpha_{jk} \left\langle \phi(\mathbf{x}_k) - \frac{1}{N} \sum_{l=1}^N \phi(\mathbf{x}_l), \phi(\mathbf{x}_i) - \frac{1}{N} \sum_{m=1}^N \phi(\mathbf{x}_m) \right\rangle \\
&amp;= \sum_{k=1}^N \alpha_{jk} \left( k(\mathbf{x}_k, \mathbf{x}_i) - \frac{1}{N} \sum_{l=1}^N k(\mathbf{x}_l, \mathbf{x}_i) - \frac{1}{N} \sum_{m=1}^N k(\mathbf{x}_i, \mathbf{x}_m) + \frac{1}{N^2} \sum_{l=1}^N \sum_{m=1} k(\mathbf{x}_l, \mathbf{x}_m) \right)
\end{align}
\end{split}\]</div>
<p>とかける。従って、<span class="math notranslate nohighlight">\(\mathbf{Z} = [\mathbf{z}_1, \ldots, \mathbf{z}_N]^\top \in \mathbb{R}^{N \times d}\)</span>とすると、<span class="math notranslate nohighlight">\(\mathbf{Z}\)</span>は行列<span class="math notranslate nohighlight">\(\mathbf{HKH}\)</span>を用いて、</p>
<div class="math notranslate nohighlight">
\[
\mathbf{Z} = \mathbf{HKH} \begin{bmatrix} \boldsymbol\alpha_1 &amp; \ldots &amp; \boldsymbol\alpha_d \end{bmatrix} = \mathbf{HKH} \begin{bmatrix} \frac{\mathbf{u}_1}{\sqrt{\lambda_1}} &amp; \ldots &amp; \frac{\mathbf{u}_d}{\sqrt{\lambda_d}} \end{bmatrix}
\]</div>
<p>となることが分かる。</p>
<hr class="docutils" />
<p>では、ここまでの議論を元にカーネル主成分分析を実装してみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># カーネル行列の計算</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">D_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">X_sr</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">X_sr</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">K_sr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">D_sr</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">K_sr</span> <span class="o">=</span> <span class="n">H</span> <span class="o">@</span> <span class="n">K_sr</span> <span class="o">@</span> <span class="n">H</span>

<span class="c1"># カーネル行列の最大固有値を求める</span>
<span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">K_sr</span><span class="p">,</span> <span class="n">subset_by_index</span><span class="o">=</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">eigval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eigval</span><span class="p">)</span>
<span class="n">eigvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">eigvec</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 低次元空間表現を得る</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">K_sr</span> <span class="o">@</span> <span class="n">eigvec</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigval</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Kernel PCA&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/4658f70af8114311e3bc825c965a654047b241a70924162186f680236e57b922.png" src="../../_images/4658f70af8114311e3bc825c965a654047b241a70924162186f680236e57b922.png" />
</div>
</div>
<p>このようにカーネル法を用いたことで、単なる主成分分析とは異なり、非線形の射影によって、データ全体がより一様に近い形で低次元空間に射影されていることが分かる。</p>
<p>上記と等価のコードをscikit-learnによって実現すると以下のようになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">KernelPCA</span>

<span class="n">kpca</span> <span class="o">=</span> <span class="n">KernelPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">z_sr</span> <span class="o">=</span> <span class="n">kpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データの可視化</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Kernel PCA (scikit-learn)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/5779cf369a6be9ba9115b35b32128769f188fd1cf4bbcea9d412345099c968d6.png" src="../../_images/5779cf369a6be9ba9115b35b32128769f188fd1cf4bbcea9d412345099c968d6.png" />
</div>
</div>
<p>ただし、カーネル主成分分析は、カーネル法に用いるカーネルの種類と、そのカーネルを定義するパラメータに大きく依存している。例えば、上記のようにRBFカーネル <span class="math notranslate nohighlight">\(k(\mathbf{x}_i, \mathbf{x}_j) = \exp(-\gamma \| \mathbf{x}_i - \mathbf{x}_j \|^2)\)</span>を用いる場合、<span class="math notranslate nohighlight">\(\gamma\)</span>変化させることで全く異なる低次元空間表現が与えられる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gammas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gammas</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gammas</span><span class="p">):</span>
    <span class="n">kpca</span> <span class="o">=</span> <span class="n">KernelPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
    <span class="n">z_sr</span> <span class="o">=</span> <span class="n">kpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_sr</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">z_sr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;$\gamma$ = </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/95419297f0eef36a005a046c00a2a167d4d7129e9052c5592e819a266f440cc4.png" src="../../_images/95419297f0eef36a005a046c00a2a167d4d7129e9052c5592e819a266f440cc4.png" />
</div>
</div>
<p>これはカーネル主成分分析に限らないが、次元圧縮のアルゴリズムにはいくつかのパラメータがあることがほとんどで、それらを変更すると、全く異なる結果が得られることも多い。従って、scikit-learn等のライブラリを用いる場合も、その背景でどのような計算が行われているのかを考えた上で、パラメータを適切に設定することが大切である。</p>
</section>
</section>
<section id="mnist">
<h2><span class="section-number">1.3. </span>MNISTの分析<a class="headerlink" href="#mnist" title="Permalink to this heading">#</a></h2>
<p>ここからは、MNISTの手書き文字データに対して、主成分分析とカーネル主成分分析を適用して、データの散らばりを確認するとともに、その画像的意味について考えてみよう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以下のコードはデータのダウンロードを伴うため、少々時間がかかる</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_openml</span><span class="p">(</span><span class="s2">&quot;mnist_784&quot;</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data_home</span><span class="o">=</span><span class="s2">&quot;./mnist&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 画像として見られるように配列の形を変更</span>
<span class="n">ims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">6</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>

<span class="c1"># 最初の5枚を確認してみる</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ims</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;label is </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/329293e57e9599e21aab1d3106eeda526046c63236f3b7e3319bc95c5bfda766.png" src="../../_images/329293e57e9599e21aab1d3106eeda526046c63236f3b7e3319bc95c5bfda766.png" />
</div>
</div>
<p>例のごとく、実験にかかる時間を短縮するために、先頭<span class="output text_plain">2000</span>個のデータだけを実験に用いる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>

<span class="n">X</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">y</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">n_samples</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">n_samples</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="id9">
<h3><span class="section-number">1.3.1. </span>データ分布の可視化<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<p>まずは、MNISTの画像データを784次元のベクトルと見なして、主成分分析により、2次元ベクトルに次元圧縮してみる。ここでは見やすさのために<a class="reference internal" href="../sec1/matplotlib.html#ssec-seaborn"><span class="std std-ref">Seabornの併用</span></a>で紹介した<code class="docutils literal notranslate"><span class="pre">seaborn</span></code>の<code class="docutils literal notranslate"><span class="pre">jointplot</span></code>を用いて可視化してみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;PCA for MNIST&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0149366720fd3c0044b61b3226655efa76c1355afb3352d03e2572d9fc9042d1.png" src="../../_images/0149366720fd3c0044b61b3226655efa76c1355afb3352d03e2572d9fc9042d1.png" />
</div>
</div>
<p>このように、次元圧縮によって「0」や「1」のデータなど、重なりが少ないデータも見られる一方で、「4」、「6」、「7」のデータなどはかなり重なりが大きいことが分かる。</p>
<hr class="docutils" />
<p>次にカーネル主成分分析を用いて、次元圧縮をしてみよう。やや天下り式ではあるが、今回は以下の式で表わされるコサインカーネルを用いてカーネル主成分分析を実行する。</p>
<div class="math notranslate nohighlight">
\[
k(\mathbf{x}_i, \mathbf{x}_j) = \frac{\mathbf{x}_i^\top \mathbf{x}_j}{\| \mathbf{x}_i \| \| \mathbf{x}_j \|}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpca</span> <span class="o">=</span> <span class="n">KernelPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">kpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;KernelPCA for MNIST&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8993c9ad074dc06dbaf7f28a11b5b4ada44361110d8661f3ad426d5abaead13e.png" src="../../_images/8993c9ad074dc06dbaf7f28a11b5b4ada44361110d8661f3ad426d5abaead13e.png" />
</div>
</div>
<p>このように、次元圧縮の手法を変化させたことで、各クラスタの重なり具合が多少緩和されていることが分かる。ただし、どのような次元圧縮法であれば、より異なるラベルを持つデータの判別に役立つか、という部分は、明確でない場合が多く、あくまで、データの散らばりを見極める際の目安として、このような可視化結果を用いることが有効であろう。</p>
</section>
<section id="id10">
<h3><span class="section-number">1.3.2. </span>主成分分析の画像的な意味<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<p>次にMNISTのデータについて主成分分析をかけてみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span> <span class="o">/</span> <span class="n">n_samples</span>

<span class="c1"># 固有値分解</span>
<span class="n">eigval</span><span class="p">,</span> <span class="n">eigvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>

<span class="c1"># 固有値が大きい順にソートして、先頭の5つを取り出す</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">eigval</span><span class="p">))</span>
<span class="n">eigval</span> <span class="o">=</span> <span class="n">eigval</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
<span class="n">eigvec</span> <span class="o">=</span> <span class="n">eigvec</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 画像として見られるように配列の形を変更</span>
<span class="n">ims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">eigvec</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>

<span class="c1"># 最初の5枚を確認してみる</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ims</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;#</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/d255c5fd9a8992a875a5eee2c5ec9b3ed1ce908a74389ea582f20a98066f97f8.png" src="../../_images/d255c5fd9a8992a875a5eee2c5ec9b3ed1ce908a74389ea582f20a98066f97f8.png" />
</div>
</div>
<p>このように得られる固有ベクトルを画像としてみてみると、0から9の数字の影のようなものが見える。定性的には、これらの画像は数字の画像の共通成分のようなものを表わしており、これらの画像の線形結合を取ると、0-9に近しい画像が作れる、というわけである。</p>
<p>以下に、上記の5枚の画像をブレンドすることで、対話的に画像を変更できるシステムを用意してあるので、各自、スライダーを動かすことで画像がどのように変化するかを確認してみてほしい。</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Slider</span><span class="p">,</span> <span class="n">CustomJS</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">show</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">output_notebook</span>

<span class="n">output_notebook</span><span class="p">()</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ims</span><span class="p">)))</span>
<span class="n">im_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">w</span> <span class="o">*</span> <span class="n">im</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ims</span><span class="p">)])</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">match_aspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;$x&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;$y&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;@image&quot;</span><span class="p">)],</span>
<span class="p">)</span>

<span class="n">w1</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ws</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;w1&quot;</span><span class="p">)</span>
<span class="n">w2</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;w2&quot;</span><span class="p">)</span>
<span class="n">w3</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ws</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;w3&quot;</span><span class="p">)</span>
<span class="n">w4</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ws</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;w4&quot;</span><span class="p">)</span>
<span class="n">w5</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ws</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;w5&quot;</span><span class="p">)</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;im_avg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">im_avg</span><span class="p">],</span>
        <span class="s2">&quot;im1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ims</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="s2">&quot;im2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ims</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="s2">&quot;im3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ims</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
        <span class="s2">&quot;im4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ims</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
        <span class="s2">&quot;im5&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ims</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="p">(</span>
    <span class="n">image</span><span class="o">=</span><span class="s2">&quot;im_avg&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">dw</span><span class="o">=</span><span class="n">im_avg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">dh</span><span class="o">=</span><span class="n">im_avg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Greys256&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">callback</span> <span class="o">=</span> <span class="n">CustomJS</span><span class="p">(</span>
    <span class="n">args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span> <span class="s2">&quot;w1&quot;</span><span class="p">:</span> <span class="n">w1</span><span class="p">,</span> <span class="s2">&quot;w2&quot;</span><span class="p">:</span> <span class="n">w2</span><span class="p">,</span> <span class="s2">&quot;w3&quot;</span><span class="p">:</span> <span class="n">w3</span><span class="p">,</span> <span class="s2">&quot;w4&quot;</span><span class="p">:</span> <span class="n">w4</span><span class="p">,</span> <span class="s2">&quot;w5&quot;</span><span class="p">:</span> <span class="n">w5</span><span class="p">},</span>
    <span class="n">code</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">   // Get image data</span>
<span class="s2">   const im_avg = source.data[&#39;im_avg&#39;][0];</span>
<span class="s2">   const im1 = source.data.im1[0];</span>
<span class="s2">   const im2 = source.data.im2[0];</span>
<span class="s2">   const im3 = source.data.im3[0];</span>
<span class="s2">   const im4 = source.data.im4[0];</span>
<span class="s2">   const im5 = source.data.im5[0];</span>

<span class="s2">   // Get weights</span>
<span class="s2">   const w1_ = w1.value;</span>
<span class="s2">   const w2_ = w2.value;</span>
<span class="s2">   const w3_ = w3.value;</span>
<span class="s2">   const w4_ = w4.value;</span>
<span class="s2">   const w5_ = w5.value;</span>

<span class="s2">   // Image blending</span>
<span class="s2">   for (let i = 0; i &lt; im_avg.length; i++) {</span>
<span class="s2">        im_avg[i] = w1_ * im1[i] + w2_ * im2[i] + w3_ * im3[i] + w4_ * im4[i] + w5_ * im5[i];</span>
<span class="s2">   }</span>
<span class="s2">   source.change.emit();</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">w1</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">w2</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">w3</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">w4</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">w5</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

<span class="n">show</span><span class="p">(</span><span class="n">row</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w3</span><span class="p">,</span> <span class="n">w4</span><span class="p">,</span> <span class="n">w5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">    <style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="d0872906-4fa7-47b4-b18c-9069d2ebb44a">Loading BokehJS ...</span>
    </div>
</div><script type="application/javascript">(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    function drop(id) {
      const view = Bokeh.index.get_by_id(id)
      if (view != null) {
        view.model.document.clear()
        Bokeh.index.delete(view)
      }
    }

    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;

    // Clean up Bokeh references
    if (id != null) {
      drop(id)
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim()
            drop(id)
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded() {
    const el = document.getElementById("d0872906-4fa7-47b4-b18c-9069d2ebb44a");
    if (el != null) {
      el.textContent = "BokehJS is loading...";
    }
    if (root.Bokeh !== undefined) {
      if (el != null) {
        el.textContent = "BokehJS " + root.Bokeh.version + " successfully loaded.";
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(display_loaded, 100)
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.3.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.3.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.3.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.3.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.3.2.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
          for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }
if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("d0872906-4fa7-47b4-b18c-9069d2ebb44a")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script><div class="output text_html">
  <div id="e25ba5ff-6ff4-4247-b4ea-886588b8cff9" data-root-id="p1059" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"0db4560d-3d33-4f25-a2ca-7b43de9877ab":{"version":"3.3.2","title":"Bokeh Application","roots":[{"type":"object","name":"Row","id":"p1059","attributes":{"children":[{"type":"object","name":"Figure","id":"p1001","attributes":{"width":300,"height":300,"x_range":{"type":"object","name":"DataRange1d","id":"p1002"},"y_range":{"type":"object","name":"DataRange1d","id":"p1003"},"x_scale":{"type":"object","name":"LinearScale","id":"p1010"},"y_scale":{"type":"object","name":"LinearScale","id":"p1011"},"title":{"type":"object","name":"Title","id":"p1008"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1054","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1039","attributes":{"selected":{"type":"object","name":"Selection","id":"p1040","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1041"},"data":{"type":"map","entries":[["im_avg",[{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[28,28],"dtype":"float64","order":"little"}]],["im1",[{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[28,28],"dtype":"float64","order":"little"}]],["im2",[{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[28,28],"dtype":"float64","order":"little"}]],["im3",[{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[28,28],"dtype":"float64","order":"little"}]],["im4",[{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[28,28],"dtype":"float64","order":"little"}]],["im5",[{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[28,28],"dtype":"float64","order":"little"}]]]}}},"view":{"type":"object","name":"CDSView","id":"p1055","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1056"}}},"glyph":{"type":"object","name":"Image","id":"p1045","attributes":{"x":{"type":"value","value":0},"y":{"type":"value","value":0},"dw":{"type":"value","value":28},"dh":{"type":"value","value":28},"image":{"type":"field","field":"im_avg"},"color_mapper":{"type":"object","name":"LinearColorMapper","id":"p1046","attributes":{"palette":["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0a0a0a","#0b0b0b","#0c0c0c","#0d0d0d","#0e0e0e","#0f0f0f","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818","#191919","#1a1a1a","#1b1b1b","#1c1c1c","#1d1d1d","#1e1e1e","#1f1f1f","#202020","#212121","#222222","#232323","#242424","#252525","#262626","#272727","#282828","#292929","#2a2a2a","#2b2b2b","#2c2c2c","#2d2d2d","#2e2e2e","#2f2f2f","#303030","#313131","#323232","#333333","#343434","#353535","#363636","#373737","#383838","#393939","#3a3a3a","#3b3b3b","#3c3c3c","#3d3d3d","#3e3e3e","#3f3f3f","#404040","#414141","#424242","#434343","#444444","#454545","#464646","#474747","#484848","#494949","#4a4a4a","#4b4b4b","#4c4c4c","#4d4d4d","#4e4e4e","#4f4f4f","#505050","#515151","#525252","#535353","#545454","#555555","#565656","#575757","#585858","#595959","#5a5a5a","#5b5b5b","#5c5c5c","#5d5d5d","#5e5e5e","#5f5f5f","#606060","#616161","#626262","#636363","#646464","#656565","#666666","#676767","#686868","#696969","#6a6a6a","#6b6b6b","#6c6c6c","#6d6d6d","#6e6e6e","#6f6f6f","#707070","#717171","#727272","#737373","#747474","#757575","#767676","#777777","#787878","#797979","#7a7a7a","#7b7b7b","#7c7c7c","#7d7d7d","#7e7e7e","#7f7f7f","#808080","#818181","#828282","#838383","#848484","#858585","#868686","#878787","#888888","#898989","#8a8a8a","#8b8b8b","#8c8c8c","#8d8d8d","#8e8e8e","#8f8f8f","#909090","#919191","#929292","#939393","#949494","#959595","#969696","#979797","#989898","#999999","#9a9a9a","#9b9b9b","#9c9c9c","#9d9d9d","#9e9e9e","#9f9f9f","#a0a0a0","#a1a1a1","#a2a2a2","#a3a3a3","#a4a4a4","#a5a5a5","#a6a6a6","#a7a7a7","#a8a8a8","#a9a9a9","#aaaaaa","#ababab","#acacac","#adadad","#aeaeae","#afafaf","#b0b0b0","#b1b1b1","#b2b2b2","#b3b3b3","#b4b4b4","#b5b5b5","#b6b6b6","#b7b7b7","#b8b8b8","#b9b9b9","#bababa","#bbbbbb","#bcbcbc","#bdbdbd","#bebebe","#bfbfbf","#c0c0c0","#c1c1c1","#c2c2c2","#c3c3c3","#c4c4c4","#c5c5c5","#c6c6c6","#c7c7c7","#c8c8c8","#c9c9c9","#cacaca","#cbcbcb","#cccccc","#cdcdcd","#cecece","#cfcfcf","#d0d0d0","#d1d1d1","#d2d2d2","#d3d3d3","#d4d4d4","#d5d5d5","#d6d6d6","#d7d7d7","#d8d8d8","#d9d9d9","#dadada","#dbdbdb","#dcdcdc","#dddddd","#dedede","#dfdfdf","#e0e0e0","#e1e1e1","#e2e2e2","#e3e3e3","#e4e4e4","#e5e5e5","#e6e6e6","#e7e7e7","#e8e8e8","#e9e9e9","#eaeaea","#ebebeb","#ececec","#ededed","#eeeeee","#efefef","#f0f0f0","#f1f1f1","#f2f2f2","#f3f3f3","#f4f4f4","#f5f5f5","#f6f6f6","#f7f7f7","#f8f8f8","#f9f9f9","#fafafa","#fbfbfb","#fcfcfc","#fdfdfd","#fefefe","#ffffff"]}}}},"nonselection_glyph":{"type":"object","name":"Image","id":"p1048","attributes":{"x":{"type":"value","value":0},"y":{"type":"value","value":0},"dw":{"type":"value","value":28},"dh":{"type":"value","value":28},"global_alpha":{"type":"value","value":0.1},"image":{"type":"field","field":"im_avg"},"color_mapper":{"type":"object","name":"LinearColorMapper","id":"p1049","attributes":{"palette":["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0a0a0a","#0b0b0b","#0c0c0c","#0d0d0d","#0e0e0e","#0f0f0f","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818","#191919","#1a1a1a","#1b1b1b","#1c1c1c","#1d1d1d","#1e1e1e","#1f1f1f","#202020","#212121","#222222","#232323","#242424","#252525","#262626","#272727","#282828","#292929","#2a2a2a","#2b2b2b","#2c2c2c","#2d2d2d","#2e2e2e","#2f2f2f","#303030","#313131","#323232","#333333","#343434","#353535","#363636","#373737","#383838","#393939","#3a3a3a","#3b3b3b","#3c3c3c","#3d3d3d","#3e3e3e","#3f3f3f","#404040","#414141","#424242","#434343","#444444","#454545","#464646","#474747","#484848","#494949","#4a4a4a","#4b4b4b","#4c4c4c","#4d4d4d","#4e4e4e","#4f4f4f","#505050","#515151","#525252","#535353","#545454","#555555","#565656","#575757","#585858","#595959","#5a5a5a","#5b5b5b","#5c5c5c","#5d5d5d","#5e5e5e","#5f5f5f","#606060","#616161","#626262","#636363","#646464","#656565","#666666","#676767","#686868","#696969","#6a6a6a","#6b6b6b","#6c6c6c","#6d6d6d","#6e6e6e","#6f6f6f","#707070","#717171","#727272","#737373","#747474","#757575","#767676","#777777","#787878","#797979","#7a7a7a","#7b7b7b","#7c7c7c","#7d7d7d","#7e7e7e","#7f7f7f","#808080","#818181","#828282","#838383","#848484","#858585","#868686","#878787","#888888","#898989","#8a8a8a","#8b8b8b","#8c8c8c","#8d8d8d","#8e8e8e","#8f8f8f","#909090","#919191","#929292","#939393","#949494","#959595","#969696","#979797","#989898","#999999","#9a9a9a","#9b9b9b","#9c9c9c","#9d9d9d","#9e9e9e","#9f9f9f","#a0a0a0","#a1a1a1","#a2a2a2","#a3a3a3","#a4a4a4","#a5a5a5","#a6a6a6","#a7a7a7","#a8a8a8","#a9a9a9","#aaaaaa","#ababab","#acacac","#adadad","#aeaeae","#afafaf","#b0b0b0","#b1b1b1","#b2b2b2","#b3b3b3","#b4b4b4","#b5b5b5","#b6b6b6","#b7b7b7","#b8b8b8","#b9b9b9","#bababa","#bbbbbb","#bcbcbc","#bdbdbd","#bebebe","#bfbfbf","#c0c0c0","#c1c1c1","#c2c2c2","#c3c3c3","#c4c4c4","#c5c5c5","#c6c6c6","#c7c7c7","#c8c8c8","#c9c9c9","#cacaca","#cbcbcb","#cccccc","#cdcdcd","#cecece","#cfcfcf","#d0d0d0","#d1d1d1","#d2d2d2","#d3d3d3","#d4d4d4","#d5d5d5","#d6d6d6","#d7d7d7","#d8d8d8","#d9d9d9","#dadada","#dbdbdb","#dcdcdc","#dddddd","#dedede","#dfdfdf","#e0e0e0","#e1e1e1","#e2e2e2","#e3e3e3","#e4e4e4","#e5e5e5","#e6e6e6","#e7e7e7","#e8e8e8","#e9e9e9","#eaeaea","#ebebeb","#ececec","#ededed","#eeeeee","#efefef","#f0f0f0","#f1f1f1","#f2f2f2","#f3f3f3","#f4f4f4","#f5f5f5","#f6f6f6","#f7f7f7","#f8f8f8","#f9f9f9","#fafafa","#fbfbfb","#fcfcfc","#fdfdfd","#fefefe","#ffffff"]}}}},"muted_glyph":{"type":"object","name":"Image","id":"p1051","attributes":{"x":{"type":"value","value":0},"y":{"type":"value","value":0},"dw":{"type":"value","value":28},"dh":{"type":"value","value":28},"global_alpha":{"type":"value","value":0.2},"image":{"type":"field","field":"im_avg"},"color_mapper":{"type":"object","name":"LinearColorMapper","id":"p1052","attributes":{"palette":["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0a0a0a","#0b0b0b","#0c0c0c","#0d0d0d","#0e0e0e","#0f0f0f","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818","#191919","#1a1a1a","#1b1b1b","#1c1c1c","#1d1d1d","#1e1e1e","#1f1f1f","#202020","#212121","#222222","#232323","#242424","#252525","#262626","#272727","#282828","#292929","#2a2a2a","#2b2b2b","#2c2c2c","#2d2d2d","#2e2e2e","#2f2f2f","#303030","#313131","#323232","#333333","#343434","#353535","#363636","#373737","#383838","#393939","#3a3a3a","#3b3b3b","#3c3c3c","#3d3d3d","#3e3e3e","#3f3f3f","#404040","#414141","#424242","#434343","#444444","#454545","#464646","#474747","#484848","#494949","#4a4a4a","#4b4b4b","#4c4c4c","#4d4d4d","#4e4e4e","#4f4f4f","#505050","#515151","#525252","#535353","#545454","#555555","#565656","#575757","#585858","#595959","#5a5a5a","#5b5b5b","#5c5c5c","#5d5d5d","#5e5e5e","#5f5f5f","#606060","#616161","#626262","#636363","#646464","#656565","#666666","#676767","#686868","#696969","#6a6a6a","#6b6b6b","#6c6c6c","#6d6d6d","#6e6e6e","#6f6f6f","#707070","#717171","#727272","#737373","#747474","#757575","#767676","#777777","#787878","#797979","#7a7a7a","#7b7b7b","#7c7c7c","#7d7d7d","#7e7e7e","#7f7f7f","#808080","#818181","#828282","#838383","#848484","#858585","#868686","#878787","#888888","#898989","#8a8a8a","#8b8b8b","#8c8c8c","#8d8d8d","#8e8e8e","#8f8f8f","#909090","#919191","#929292","#939393","#949494","#959595","#969696","#979797","#989898","#999999","#9a9a9a","#9b9b9b","#9c9c9c","#9d9d9d","#9e9e9e","#9f9f9f","#a0a0a0","#a1a1a1","#a2a2a2","#a3a3a3","#a4a4a4","#a5a5a5","#a6a6a6","#a7a7a7","#a8a8a8","#a9a9a9","#aaaaaa","#ababab","#acacac","#adadad","#aeaeae","#afafaf","#b0b0b0","#b1b1b1","#b2b2b2","#b3b3b3","#b4b4b4","#b5b5b5","#b6b6b6","#b7b7b7","#b8b8b8","#b9b9b9","#bababa","#bbbbbb","#bcbcbc","#bdbdbd","#bebebe","#bfbfbf","#c0c0c0","#c1c1c1","#c2c2c2","#c3c3c3","#c4c4c4","#c5c5c5","#c6c6c6","#c7c7c7","#c8c8c8","#c9c9c9","#cacaca","#cbcbcb","#cccccc","#cdcdcd","#cecece","#cfcfcf","#d0d0d0","#d1d1d1","#d2d2d2","#d3d3d3","#d4d4d4","#d5d5d5","#d6d6d6","#d7d7d7","#d8d8d8","#d9d9d9","#dadada","#dbdbdb","#dcdcdc","#dddddd","#dedede","#dfdfdf","#e0e0e0","#e1e1e1","#e2e2e2","#e3e3e3","#e4e4e4","#e5e5e5","#e6e6e6","#e7e7e7","#e8e8e8","#e9e9e9","#eaeaea","#ebebeb","#ececec","#ededed","#eeeeee","#efefef","#f0f0f0","#f1f1f1","#f2f2f2","#f3f3f3","#f4f4f4","#f5f5f5","#f6f6f6","#f7f7f7","#f8f8f8","#f9f9f9","#fafafa","#fbfbfb","#fcfcfc","#fdfdfd","#fefefe","#ffffff"]}}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1009","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1022"},{"type":"object","name":"WheelZoomTool","id":"p1023","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1024","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1025","attributes":{"syncable":false,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1030"},{"type":"object","name":"ResetTool","id":"p1031"},{"type":"object","name":"HelpTool","id":"p1032"},{"type":"object","name":"HoverTool","id":"p1033","attributes":{"renderers":"auto","tooltips":[["x","$x"],["y","$y"],["value","@image"]]}}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1017","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1018","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1019"},"major_label_policy":{"type":"object","name":"AllLabels","id":"p1020"}}}],"below":[{"type":"object","name":"LinearAxis","id":"p1012","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1013","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1014"},"major_label_policy":{"type":"object","name":"AllLabels","id":"p1015"}}}],"center":[{"type":"object","name":"Grid","id":"p1016","attributes":{"axis":{"id":"p1012"}}},{"type":"object","name":"Grid","id":"p1021","attributes":{"dimension":1,"axis":{"id":"p1017"}}}],"match_aspect":true}},{"type":"object","name":"Column","id":"p1058","attributes":{"children":[{"type":"object","name":"Slider","id":"p1034","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"type":"object","name":"CustomJS","id":"p1057","attributes":{"args":{"type":"map","entries":[["source",{"id":"p1039"}],["w1",{"id":"p1034"}],["w2",{"type":"object","name":"Slider","id":"p1035","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"id":"p1057"}]]]},"title":"w2","start":-1.0,"end":1.0,"value":0.6654448907291886,"step":0.05}}],["w3",{"type":"object","name":"Slider","id":"p1036","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"id":"p1057"}]]]},"title":"w3","start":-1.0,"end":1.0,"value":-0.3639845060113964,"step":0.05}}],["w4",{"type":"object","name":"Slider","id":"p1037","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"id":"p1057"}]]]},"title":"w4","start":-1.0,"end":1.0,"value":-0.9674993445903866,"step":0.05}}],["w5",{"type":"object","name":"Slider","id":"p1038","attributes":{"js_property_callbacks":{"type":"map","entries":[["change:value",[{"id":"p1057"}]]]},"title":"w5","start":-1.0,"end":1.0,"value":-0.26586888049737434,"step":0.05}}]]},"code":"\n   // Get image data\n   const im_avg = source.data['im_avg'][0];\n   const im1 = source.data.im1[0];\n   const im2 = source.data.im2[0];\n   const im3 = source.data.im3[0];\n   const im4 = source.data.im4[0];\n   const im5 = source.data.im5[0];\n\n   // Get weights\n   const w1_ = w1.value;\n   const w2_ = w2.value;\n   const w3_ = w3.value;\n   const w4_ = w4.value;\n   const w5_ = w5.value;\n\n   // Image blending\n   for (let i = 0; i < im_avg.length; i++) {\n        im_avg[i] = w1_ * im1[i] + w2_ * im2[i] + w3_ * im3[i] + w4_ * im4[i] + w5_ * im5[i];\n   }\n   source.change.emit();\n"}}]]]},"title":"w1","start":-1.0,"end":1.0,"value":-0.7490100404349582,"step":0.05}},{"id":"p1035"},{"id":"p1036"},{"id":"p1037"},{"id":"p1038"}]}}]}}]}};
  const render_items = [{"docid":"0db4560d-3d33-4f25-a2ca-7b43de9877ab","roots":{"p1059":"e25ba5ff-6ff4-4247-b4ea-886588b8cff9"},"root_ids":["p1059"]}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>図を見てみると、概ね同じ数字が近くに集まってクラスタを形成していることが分かる。上図は2次元までベクトルを圧縮して作成しているため、数字同士の領域に大きな重複が見られるが、もう少し高い次元であれば、各数字の占める領域が重ならないようにすることができそうだ。</p>
</section>
</section>
<section id="id11">
<h2><span class="section-number">1.4. </span>練習問題<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>多次元尺度構成法の項で紹介した<a class="reference internal" href="#equation-eq-mds">(1.5)</a>を自身で導出せよ。</p></li>
<li><p>単純なMDSとSMACOFを用いたMDSをMNISTのデータに適用し、違いについて考察せよ。</p></li>
<li><p>MNISTのデータについて、コサインカーネルを行った主成分分析により得られる画像を第⑤主成分まで調べて見よ (ヒント: <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>の<code class="docutils literal notranslate"><span class="pre">KernelPCA</span></code>で<code class="docutils literal notranslate"><span class="pre">inverse_transform=True</span></code>を用いる)。</p></li>
</ol>
</section>
<section id="id12">
<h2><span class="section-number">1.5. </span>参考文献<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h2>
<div class="docutils container" id="id13">
<dl class="citation">
<dt class="label" id="id27"><span class="brackets"><a class="fn-backref" href="#id7">DG03</a></span></dt>
<dd><p>David L Donoho and Carrie Grimes. Hessian eigenmaps: locally linear embedding techniques for high-dimensional data. <em>Proceedings of the National Academy of Sciences</em>, 100(10):5591–5596, 2003.</p>
</dd>
<dt class="label" id="id24"><span class="brackets"><a class="fn-backref" href="#id3">Lee77</a></span></dt>
<dd><p>De Leeuw. Application of convex analysis to multidimensional scaling. <em>Recent Developments in Statistics</em>, pages 133–145, 1977.</p>
</dd>
<dt class="label" id="id25"><span class="brackets"><a class="fn-backref" href="#id5">RS00</a></span></dt>
<dd><p>Sam T. Roweis and Lawrence K. Saul. Nonlinear dimensionality reduction by locally linear embedding. <em>Science</em>, 290(5500):2323–2326, dec 2000. <a class="reference external" href="https://doi.org/10.1126/science.290.5500.2323">doi:10.1126/science.290.5500.2323</a>.</p>
</dd>
<dt class="label" id="id26"><span class="brackets"><a class="fn-backref" href="#id6">ZW06</a></span></dt>
<dd><p>Zhenyue Zhang and Jing Wang. Mlle: modified locally linear embedding using multiple weights. In B. Schölkopf, J. Platt, and T. Hoffman, editors, <em>Advances in Neural Information Processing Systems</em>, volume 19. MIT Press, 2006. URL: <a class="reference external" href="https://proceedings.neurips.cc/paper_files/paper/2006/file/fb2606a5068901da92473666256e6e5b-Paper.pdf">https://proceedings.neurips.cc/paper_files/paper/2006/file/fb2606a5068901da92473666256e6e5b-Paper.pdf</a>.</p>
</dd>
</dl>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./contents/sec2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../sec1/exercise-sudoku.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">前へ</p>
        <p class="prev-next-title"><span class="section-number">4. </span>演習1 - 画像入力式数独ソルバーを作る</p>
      </div>
    </a>
    <a class="right-next"
       href="feature-extraction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">次へ</p>
        <p class="prev-next-title"><span class="section-number">2. </span>特徴量抽出</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目次
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.1. 線形の次元圧縮</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca">1.1.1. 主成分分析 (PCA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mds">1.1.2. 多次元尺度構成法 (MDS)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.2. 非線形の次元圧縮</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isomap">1.2.1. ISOMAP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lle">1.2.2. 局所線形埋め込み法 (LLE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">1.2.3. カーネル主成分分析</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mnist">1.3. MNISTの分析</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">1.3.1. データ分布の可視化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">1.3.2. 主成分分析の画像的な意味</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">1.4. 練習問題</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">1.5. 参考文献</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
著者 Tatsuya Yatagawa
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CC BY-NC-SA 4.0, 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>