

<!DOCTYPE html>


<html lang="ja" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. Q学習の基礎 &#8212; 機械学習発展 (実践)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/custom.js"></script>
    <script src="../../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="application/vnd.jupyter.widget-state+json">{"state": {"c6923a6973e94caf8e630034f3b6ec73": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fb5bcccc726643b1a0d6e94a443bd45c": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "5672bf78802f4e00b060175eb98e58d2": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_c6923a6973e94caf8e630034f3b6ec73", "max": 10000.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_fb5bcccc726643b1a0d6e94a443bd45c", "tabbable": null, "tooltip": null, "value": 10000.0}}, "9cfad5bdc8464cb7a244668465d48d80": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "59e5e5db88704648afcd084092519d36": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "ddade9a92fa14a649456d9f38828d3e2": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_9cfad5bdc8464cb7a244668465d48d80", "placeholder": "\u200b", "style": "IPY_MODEL_59e5e5db88704648afcd084092519d36", "tabbable": null, "tooltip": null, "value": "100%"}}, "6e95d9ed6bf14dc59889a97837e0388e": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fb70d0a092894c60a250685813e0b857": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "2c98d35cb6e74dd58d615444d6e4e0a4": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_6e95d9ed6bf14dc59889a97837e0388e", "placeholder": "\u200b", "style": "IPY_MODEL_fb70d0a092894c60a250685813e0b857", "tabbable": null, "tooltip": null, "value": "\u200710000/10000\u2007[00:55&lt;00:00,\u2007315.95it/s]"}}, "2a5c859e27704b5b8524d08665b0549f": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "c0d7374167874ff59ac0ad66314a6c82": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_ddade9a92fa14a649456d9f38828d3e2", "IPY_MODEL_5672bf78802f4e00b060175eb98e58d2", "IPY_MODEL_2c98d35cb6e74dd58d615444d6e4e0a4"], "layout": "IPY_MODEL_2a5c859e27704b5b8524d08665b0549f", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contents/sec3/q-learning';</script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="3. オセロAIの作成" href="othello-agent.html" />
    <link rel="prev" title="1. 強化学習の基礎" href="reinforcement-learning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">機械学習発展 (実践)</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">第0部 各種基本ライブラリの使用法</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sec1/numpy.html">1. NumPyの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/matplotlib.html">2. Matplotlibの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/pandas.html">3. Pandasの基本</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第1部 画像読み取り式数独ソルバの実装</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sec1/opencv.html">1. OpenCVの基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/figure-detection.html">2. 図形の検出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/scikit-learn.html">3. scikit-learnによる機械分類の基本</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec1/exercise-sudoku.html">4. 演習1 - 画像入力式数独ソルバーを作る</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第2部 ひらがなOCRソフトと百人一首エージェントの実装</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sec2/data-visualization.html">1. データ可視化と次元圧縮</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec2/feature-extraction.html">2. 特徴量抽出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec2/deep-learning.html">3. 深層学習による物体認識</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sec2/exercise-ogura.html">4. 演習2 - 百人一首エージェントを作る</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第3部 強化学習の基礎とリバーシエージェントの実装</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="reinforcement-learning.html">1. 強化学習の基礎</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Q学習の基礎</a></li>
<li class="toctree-l1"><a class="reference internal" href="othello-agent.html">3. オセロAIの作成</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep-reinforcement-learning.html">4. 深層強化学習</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise-othello.html">5. 演習3 - オセロエージェントを作る</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix/notation.html">資料中の表記について</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/tatsy/1284-sds-ml-advanced/blob/master/./contents/sec3/q-learning.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tatsy/1284-sds-ml-advanced" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="ソースリポジトリ"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tatsy/1284-sds-ml-advanced/issues/new?title=Issue%20on%20page%20%2Fcontents/sec3/q-learning.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="問題を報告"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="このページをダウンロード">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/contents/sec3/q-learning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="ソースファイルをダウンロード"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="PDFに印刷"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全画面モード"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Q学習の基礎</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目次 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1. 背景</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.2. アルゴリズム</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.3. 倒立振子のバランシング</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.3.1. ランダムな行動選択</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.3.2. Q学習による行動選択</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#varepsilon-greedyq">2.3.3. <span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法によるQテーブルの更新</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.4. 練習問題</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="q">
<span id="sec-q-learning"></span><h1><span class="section-number">2. </span>Q学習の基礎<a class="headerlink" href="#q" title="Permalink to this heading">#</a></h1>
<p>ここまでで扱った多腕バンディット問題は、取れる行動の種類が少なく、また、問題の状態が変化しない、すなわち、いつスロットを回しても、各アームの当たり確率は変化しない、という特徴があった。しかし、実際の問題は取れるべき行動の種類が多く(場合によっては連続変数)、また、ある時刻で取った行動により、行動を行う対象の状態が変化するのが一般的である。</p>
<p>このような状況において用いられる強化学習の手法に<strong>Q学習</strong>がある。Q学習のQとは<strong>行動価値関数</strong>を表すQ値のQであり、とある<strong>状態</strong><span class="math notranslate nohighlight">\(s\)</span> (stateのs)において取った<strong>行動</strong><span class="math notranslate nohighlight">\(a\)</span> (actionのa)の価値を関数として、<span class="math notranslate nohighlight">\(Q(s, a)\)</span>のように表す。</p>
<p>このようなQ値を学習する方法はQ学習以外にも<strong>SARSA</strong>(state-action-reward-state-action)と呼ばれる方法もあるが、本節ではQ学習に絞って説明する。</p>
<hr class="docutils" />
<p><strong>Google Colab用の準備</strong></p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IN_COLAB</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">google.colab</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are running the code in Google Colab.&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are running the code on the local computer.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="c1"># Gymnasiumのインストール</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>myst-nb
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;gymnasium[classic-control]&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>下準備のコード</strong></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">IPython.display</span> <span class="k">as</span> <span class="nn">display</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">ArtistAnimation</span>

<span class="c1"># 乱数のシードを固定</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">31415</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">31415</span><span class="p">)</span>

<span class="c1"># グラフの設定</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="id1">
<h2><span class="section-number">2.1. </span>背景<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>Q学習で扱う対象は<strong>Markov決定過程</strong>と呼ばれる状態遷移のモデルである。</p>
<p>Markov決定過程をかみ砕いて言えば、その時々で取った行動により次の状態が変化するが、それより過去に取った行動がその状態の変化に影響を与えることはない、という性質 (この性質を<strong>Markov性</strong>と呼ぶ)を満たす状態遷移のモデルである。</p>
<p>Markov性を満たす状態遷移であれば、とある状態<span class="math notranslate nohighlight">\(s\)</span>において、行動を<span class="math notranslate nohighlight">\(a\)</span>取ったときに、別の状態<span class="math notranslate nohighlight">\(s'\)</span>に移る確率は<span class="math notranslate nohighlight">\(s, a\)</span>だけに関する事後確率として<span class="math notranslate nohighlight">\(P(s' | s, a)\)</span>のように書ける。</p>
<p>Q学習では、この事後分布<span class="math notranslate nohighlight">\(P(s' | s, a)\)</span>を用いて、行動評価関数<span class="math notranslate nohighlight">\(Q(s, a)\)</span>が以下のBellmanの最適性公式を満たすと仮定する。</p>
<div class="math notranslate nohighlight" id="equation-eq-bellman-equation">
<span class="eqno">(2.8)<a class="headerlink" href="#equation-eq-bellman-equation" title="この数式へのパーマリンク">#</a></span>\[
Q(s, a) = R(s, a) + \gamma \sum_{a' \in \mathcal{A}} P(s' | s, a) Q(s', a')
\]</div>
<p>この式において<span class="math notranslate nohighlight">\(\gamma\)</span>は<strong>割引因子</strong> (discount factor)と呼ばれる値で、<span class="math notranslate nohighlight">\(0 &lt; \gamma &lt; 1\)</span>であり、<span class="math notranslate nohighlight">\(R(s, a)\)</span>は状態<span class="math notranslate nohighlight">\(s\)</span>において行動<span class="math notranslate nohighlight">\(a\)</span>を取ったときに即座に得られる報酬を表す。</p>
<p><a class="reference internal" href="#equation-eq-bellman-equation">(2.8)</a>は、<strong>最適な行動価値関数が、その時、即座に得られる報酬<span class="math notranslate nohighlight">\(R(s, a)\)</span>と未来の行動から得られる報酬に一定の減衰を加えたものの和として表せる</strong>ことを示している。</p>
<p>一方、多くの状態遷移のモデルでは、状態遷移は確率的なものではなく、行動<span class="math notranslate nohighlight">\(a\)</span>の結果として<strong>一意に次の状態が決まる</strong>ことが多い。そこで<span class="math notranslate nohighlight">\(P(s' | s, a) = 1\)</span>と仮定する。さらに、仮に理想的なQ関数が求まっているのであれば、<span class="math notranslate nohighlight">\(s'\)</span>において行動価値が最大になる行動<span class="math notranslate nohighlight">\(a'\)</span>をQ関数から決定できるので、<span class="math notranslate nohighlight">\(a'\)</span>は行動価値が最大になるものであると仮定する。</p>
<p>これら2つの仮定により、<a class="reference internal" href="#equation-eq-bellman-equation">(2.8)</a>は、以下の形で書き直せる。</p>
<div class="math notranslate nohighlight" id="equation-eq-bellman-equation-2">
<span class="eqno">(2.9)<a class="headerlink" href="#equation-eq-bellman-equation-2" title="この数式へのパーマリンク">#</a></span>\[
Q(s, a) = R(s, a) + \gamma \max_{a' \in \mathcal{A}} Q(s', a')
\]</div>
<p>Q学習は、<a class="reference internal" href="#equation-eq-bellman-equation-2">(2.9)</a>を満たすような<span class="math notranslate nohighlight">\(Q(s, a)\)</span>を強化学習の枠組みによって求めるものである。</p>
</section>
<section id="id2">
<h2><span class="section-number">2.2. </span>アルゴリズム<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>Q学習は、実際の環境において、適当な行動を取ったときに得られる報酬と状態遷移から、<a class="reference internal" href="#equation-eq-bellman-equation-2">(2.9)</a>の両辺の差が小さくなるように<span class="math notranslate nohighlight">\(Q(s, a)\)</span>の値を更新する。</p>
<p>典型的なQ学習の実装では、<span class="math notranslate nohighlight">\(s\)</span>と<span class="math notranslate nohighlight">\(a\)</span>を離散化して、<span class="math notranslate nohighlight">\(Q(s, a)\)</span>を二次元配列として扱う。このような離散化されたQ関数を<strong>Qテーブル</strong>と呼ぶ。</p>
<p>Qテーブルの更新は現在の<span class="math notranslate nohighlight">\(Q(s, a)\)</span>の値 (学習途中は必ずしも<a class="reference internal" href="#equation-eq-bellman-equation-2">(2.9)</a>を満たしていないことに注意)を<a class="reference internal" href="#equation-eq-bellman-equation-2">(2.9)</a>の右辺に近づくように更新する。</p>
<p>具体的には、学習率<span class="math notranslate nohighlight">\(0 &lt; \alpha &lt; 1\)</span>を用いて、以下の式で<span class="math notranslate nohighlight">\(Q(s, a)\)</span>を更新する。</p>
<div class="math notranslate nohighlight">
\[
Q_{\rm new}(s, a) = (1 - \alpha) Q(s, a) + \alpha \left[ R(s, a) + \gamma \max_{a'} Q(s', a') \right]
\]</div>
<p>また、この式は以下の形で書き直すことができる。</p>
<div class="math notranslate nohighlight" id="equation-eq-q-update">
<span class="eqno">(2.10)<a class="headerlink" href="#equation-eq-q-update" title="この数式へのパーマリンク">#</a></span>\[
Q_{\rm new}(s, a) = Q(s,a ) + \alpha \left[ R(s, a) + \gamma \max_{a'} Q(s', a') - Q(s, a) \right]
\]</div>
<p><a class="reference internal" href="#equation-eq-q-update">(2.10)</a>の右辺の</p>
<div class="math notranslate nohighlight">
\[
R(s, a) + \gamma \max_{a'} Q(s', a') - Q(s, a)
\]</div>
<p>は、<strong>TD誤差</strong> (temporal difference error)と呼ばれ、Q学習はこのTD誤差を最小化する問題であると言い換えることができる。</p>
</section>
<section id="id3">
<h2><span class="section-number">2.3. </span>倒立振子のバランシング<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>Q学習を実際に試すために、比較的単純な倒立振子のバランスを取るゲームについて考える。倒立振子のシミュレータは<a class="reference external" href="https://gymnasium.farama.org/">Gymnasium</a>というライブラリ(旧名: OpenAI Gym)から簡単に使用することができる。</p>
<p>モジュール<code class="docutils literal notranslate"><span class="pre">gymnasium</span></code>をインポート後 (<code class="docutils literal notranslate"><span class="pre">gym</span></code>とエイリアスをつける)、<code class="docutils literal notranslate"><span class="pre">gym.make</span></code>関数を用いてゲーム環境<code class="docutils literal notranslate"><span class="pre">env</span></code>を作成してみる。</p>
<p><code class="docutils literal notranslate"><span class="pre">gym.make</span></code>関数に倒立振子のゲーム環境である<code class="docutils literal notranslate"><span class="pre">CartPole-v1</span></code>を指定し、<code class="docutils literal notranslate"><span class="pre">render_mode</span></code>パラメータに<code class="docutils literal notranslate"><span class="pre">rbg_array</span></code>を指定する。</p>
<p>このように<code class="docutils literal notranslate"><span class="pre">render_mode</span></code>を指定しておくと、<code class="docutils literal notranslate"><span class="pre">env.render</span></code>関数によって画面の情報をNumPyの配列として得ることができるので、Matplotlibを用いて、初期状態を描画してみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gymnasium</span> <span class="k">as</span> <span class="nn">gym</span>

<span class="c1"># ゲーム環境の作成</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">&quot;CartPole-v1&quot;</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="s2">&quot;rgb_array&quot;</span><span class="p">)</span>

<span class="c1"># ゲーム環境のリセット</span>
<span class="n">obsrv</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">31415</span><span class="p">)</span>

<span class="c1"># 現在の状態をRGB画像として取得する</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/d3937f1a9f7587b758aa1e0a21d7cfc36b970dc742d996f271618dab000732f8.png" src="../../_images/d3937f1a9f7587b758aa1e0a21d7cfc36b970dc742d996f271618dab000732f8.png" />
</div>
</div>
<p>このように、CartPoleは台車 (cart)の上に倒立振子 (pole)が取り付けられたものを制御して、できる限り長い時間、振子が倒れないようにバランスを取るゲームである。</p>
<p>倒立振子は、その状態を表すいくつかのパラメータを持っており、それが<code class="docutils literal notranslate"><span class="pre">reset</span></code>関数の戻り値として取得される<code class="docutils literal notranslate"><span class="pre">obsrv</span></code>の中に格納されている。</p>
<p><code class="docutils literal notranslate"><span class="pre">obsrv</span></code>は<code class="docutils literal notranslate"><span class="pre">tuple</span></code>型の変数になっていて、CartPole環境の場合には<strong>第1要素に状態を表す変数が入っている</strong>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 現在の状態変数を確認</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obsrv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-3.1067048e-05 -3.8479745e-02  3.6217723e-02  3.3740070e-02]
</pre></div>
</div>
</div>
</div>
<p>CartPole環境の場合は、4つの浮動小数が格納されており、先頭から、</p>
<ul class="simple">
<li><p>台車の水平位置</p></li>
<li><p>台車の速度</p></li>
<li><p>振子の角度</p></li>
<li><p>振子の角速度
をそれぞれ表している。</p></li>
</ul>
<p>また、それぞれの値が取る範囲は以下のようになっている <a class="reference external" href="https://gymnasium.farama.org/environments/classic_control/cart_pole/">[参考URL]</a>。</p>
<div class="pst-scrollable-table-container"><table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Num</p></th>
<th class="head"><p>Observation</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Max</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>台車の位置</p></td>
<td><p>-4.8</p></td>
<td><p>+4.8</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>台車の速度</p></td>
<td><p>-Inf</p></td>
<td><p>+Inf</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>振子の角度</p></td>
<td><p>-24°</p></td>
<td><p>+24°</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>振子の角速度</p></td>
<td><p>-Inf</p></td>
<td><p>+Inf</p></td>
</tr>
</tbody>
</table>
</div>
<p>この値は、<code class="docutils literal notranslate"><span class="pre">env</span></code>の<code class="docutils literal notranslate"><span class="pre">observation_space</span></code>フィールドで確認することができる。</p>
<p>CartPole環境の場合には<code class="docutils literal notranslate"><span class="pre">observation_space</span></code>は<code class="docutils literal notranslate"><span class="pre">Box</span></code>という型で表されていて、<code class="docutils literal notranslate"><span class="pre">low</span></code>、<code class="docutils literal notranslate"><span class="pre">high</span></code>というフィールドにパラメータの最小値、最大値が格納されている。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lower bound:&quot;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Upper bound:&quot;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lower bound: [-4.8000002e+00 -3.4028235e+38 -4.1887903e-01 -3.4028235e+38]
Upper bound: [4.8000002e+00 3.4028235e+38 4.1887903e-01 3.4028235e+38]
</pre></div>
</div>
</div>
</div>
<p>Gyminasiumのゲーム環境には、この他にも多数の関数が用意されており、それを強化学習に用いることができる。</p>
<p>まずは、その挙動を理解するために、ランダムに行動を選んだ場合にどのような動きになるのかを確認してみよう。</p>
<p>ランダムな行動選択には、<code class="docutils literal notranslate"><span class="pre">env.action_space.sample()</span></code>を使うことができる。CartPole環境の場合には<code class="docutils literal notranslate"><span class="pre">env.action_space.n</span></code>に格納されているとおり、取り得る行動は <strong>0: 左に移動</strong>, <strong>1: 右に移動</strong> の2つだけなので、<code class="docutils literal notranslate"><span class="pre">sample</span></code>関数はこのうちの一方をランダムに返してくる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ランダムに5回行動選択をしてみる</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
1
1
1
0
1
1
0
1
1
</pre></div>
</div>
</div>
</div>
<p>選んだ行動をとって状態を更新するには<code class="docutils literal notranslate"><span class="pre">env.step</span></code>関数を用いる。<code class="docutils literal notranslate"><span class="pre">step</span></code>関数の引数に行動を表す整数を与えることで状態が更新される。</p>
<p><code class="docutils literal notranslate"><span class="pre">step</span></code>関数もまた<code class="docutils literal notranslate"><span class="pre">reset</span></code>関数と同様に<code class="docutils literal notranslate"><span class="pre">tuple</span></code>型の変数を返してくる。ここには<code class="docutils literal notranslate"><span class="pre">reset</span></code>関数の時よりも多くの情報が含まれていて、</p>
<ul class="simple">
<li><p><strong>第1要素:</strong> 現在の状態を表すパラメータ (上記の<code class="docutils literal notranslate"><span class="pre">obsrv</span></code>と同様)</p></li>
<li><p><strong>第2要素:</strong> 行動により直接得られた報酬</p></li>
<li><p><strong>第3要素:</strong> エピソードが終了したかどうか (ゲームオーバーになったかどうか)</p></li>
<li><p><strong>第4要素:</strong> 行動を表すパラメータが範囲外に外れたかどうか (今回は使用しない)</p></li>
<li><p><strong>第5要素:</strong> その他の追加情報 (今回は使用しない)</p></li>
</ul>
<p>のような構成となっている。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obsrv</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Observation:&quot;</span><span class="p">,</span> <span class="n">obsrv</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reward:&quot;</span><span class="p">,</span> <span class="n">reward</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished?:&quot;</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observation: [-0.00080066 -0.23410185  0.03689252  0.3376265 ]
Reward: 1.0
Finished?: False
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3><span class="section-number">2.3.1. </span>ランダムな行動選択<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<p>これらを用いてランダムに行動選択をし、その時々の状態を画像として格納する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ゲーム環境のリセット</span>
<span class="n">obsrv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># ゲームループ</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># 現在の画面を画像として保存</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="c1"># ランダムに行動選択</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

    <span class="c1"># 状態を更新する</span>
    <span class="n">obsrv</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># もしゲームが終了していたらループを抜ける</span>
    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># アニメーションの描画</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="c1"># 各フレームの描画</span>
<span class="n">draw</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;frame #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ims</span><span class="p">,</span> <span class="n">txt</span><span class="p">])</span>

<span class="c1"># アニメーションの作成</span>
<span class="n">ani</span> <span class="o">=</span> <span class="n">ArtistAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">ani</span><span class="o">.</span><span class="n">to_html5_video</span><span class="p">())</span>
<span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

<span class="c1"># Matplotlibのウィンドウを閉じる</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><video width="640" height="480" controls autoplay loop>
  <source type="video/mp4" src="data:video/mp4;base64,AAAAIGZ0eXBNNFYgAAACAE00ViBpc29taXNvMmF2YzEAAAAIZnJlZQAAFYRtZGF0AAACrgYF//+q
3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2MyByMzA2MCA1ZGI2YWE2IC0gSC4yNjQvTVBF
Ry00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMSAtIGh0dHA6Ly93d3cudmlkZW9sYW4u
b3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFs
eXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVk
X3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBk
ZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTYg
bG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRl
cmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJf
cHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9
MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEwIHNjZW5lY3V0PTQwIGludHJhX3Jl
ZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAu
NjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAE
8GWIhAAR//73iB8yy2n5OtdyEeetLq0fUO5GcV6kvf4gAAADAAADAABlQN8pUH95cNzgAAAE8AC6
hI0F/gtX+IBqbDMURRxTh117TfJEEZP/CXH2o7Gu/RWKpwhvGqOjm90FN/XJHER4uFreuUAdkBIP
lVdNbzNCPVe/Rw/6RavgNHcaFNGqVlXRZTgQOo4g5Sols5rHL4oA3jP5QmEgeSQJOy0yeVQu13T4
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
NzYuMTAw
">
  Your browser does not support the video tag.
</video></div></div>
</div>
<p>このようにランダムに行動した場合には、途中で棒の傾きが一定以上になってしまい、エピソードが終了していることが分かる。以下では、Q学習によって行動評価関数を最適化し、より長い時間、倒立状態を保てるようにしてみよう。</p>
</section>
<section id="id5">
<h3><span class="section-number">2.3.2. </span>Q学習による行動選択<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>まずはQテーブルを作成するために、4種類のパラメータを離散化しておこう。以下の例では、<strong>速度と各速度の範囲を適当に狭めておき、その上で各パラメータの取り得る範囲を8分割する</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_INPUTS</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">N_ACTIONS</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span>
<span class="n">N_DIGITS</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">lower</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">low</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">high</span>
<span class="n">lower</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span>  <span class="c1"># 速度の範囲を修正</span>
<span class="n">lower</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># 角速度の範囲を修正</span>
</pre></div>
</div>
</div>
</div>
<p>今回の倒立振子の例ではパラメータ4つを8分割しているので、取り得る離散状態の組み合わせは<span class="math notranslate nohighlight">\(8^4 = 4096\)</span>通りである。取り得る行動は左に行くか、右に行くかの2種類であるので、結局、Qテーブルのサイズは<span class="math notranslate nohighlight">\(4096 \times 2\)</span>となる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Q値テーブルの初期化 (乱数による初期化)</span>
<span class="n">q_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N_DIGITS</span><span class="o">**</span><span class="n">N_INPUTS</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>8分割されたパラメータの範囲を求めるには<code class="docutils literal notranslate"><span class="pre">np.linspace</span></code>関数が使える。この関数はこれまで第1, 第2引数にスカラー値を入力して使ってきたが、サイズが同じであれば配列を指定することもできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">N_DIGITS</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-4.8        -3.4285717  -2.057143   -0.68571424  0.68571424  2.0571427
   3.4285717   4.8       ]
 [-5.         -3.5714285  -2.142857   -0.71428585  0.71428585  2.1428576
   3.5714283   5.        ]
 [-0.41887903 -0.2991993  -0.17951958 -0.05983984  0.05983987  0.1795196
   0.29919934  0.41887903]
 [-1.5707964  -1.1219974  -0.67319846 -0.22439945  0.22439945  0.67319834
   1.1219975   1.5707964 ]]
</pre></div>
</div>
</div>
</div>
<p>今、とある状態変数が与えられた時に、それが4096個の離散状態のどれに対応するのかを定めておく必要がある。</p>
<p>これには、4つあるパラメータのそれぞれが8個の範囲のどれに入るのかを求めて、その値を元に状態を表わす整数を計算する必要がある。</p>
<p>各パラメータが8つの範囲のどれに属するかを求めるには<code class="docutils literal notranslate"><span class="pre">np.digitize</span></code>関数が使える。4つのパラメータのそれぞれについて、リスト内包表記によって所属する範囲のインデックスを求めるとすれば、以下のようなコードになる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obsrv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4, 4, 4, 4]
</pre></div>
</div>
</div>
</div>
<p>現在は各パラメータの範囲を8つに分割しているので、<code class="docutils literal notranslate"><span class="pre">digits</span></code>には0-7の整数が与えられる。従って、この数字を8進数であると考えて、10進数表記に直せば、各離散状態に対して重複のない整数のインデックスを付与することができる。</p>
<p>このような計算は、単純には以下のようなfor文を用いたコードで実現できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">*</span> <span class="n">N_DIGITS</span> <span class="o">+</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2340
</pre></div>
</div>
</div>
</div>
<p>もう少しPythonらしい書き方にするのであれば、<code class="docutils literal notranslate"><span class="pre">functools.reduce</span></code>関数を用いて以下のように書くこともできる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">N_DIGITS</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2340
</pre></div>
</div>
</div>
</div>
<p>これを踏まえて、状態を表わすインデックスを計算するコードを関数化しておく。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_state_index</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">N_DIGITS</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="varepsilon-greedyq">
<h3><span class="section-number">2.3.3. </span><span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法によるQテーブルの更新<a class="headerlink" href="#varepsilon-greedyq" title="Permalink to this heading">#</a></h3>
<p>ここまでで下準備が整ったので、前回<a class="reference internal" href="reinforcement-learning.html#sec-reinforcement-learning"><span class="std std-ref">強化学習の基礎</span></a>の節で紹介した<span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法を用いてQ学習を実行してみる。</p>
<p>Q学習においては、とある状態<span class="math notranslate nohighlight">\(s\)</span>において<strong>何らかの方策</strong>によって行動<span class="math notranslate nohighlight">\(a\)</span>を決定し、行動後の状態<span class="math notranslate nohighlight">\(s'\)</span>を得る。その後、<span class="math notranslate nohighlight">\(s\)</span>, <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(s'\)</span>の組に基づき、<a class="reference internal" href="#equation-eq-q-update">(2.10)</a>に従ってQテーブルを更新する。</p>
<p>この際、行動<span class="math notranslate nohighlight">\(a\)</span>を決定する際に用いる方策に、<span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法の他、前節で紹介した手法が使える。</p>
<p>Q学習で<span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法を用いる場合、多腕バンディット問題の時と同様、適当な<span class="math notranslate nohighlight">\(0 &lt; \varepsilon &lt; 1\)</span>を決めておき、<span class="math notranslate nohighlight">\(\varepsilon\)</span>の確率でランダムな行動を、<span class="math notranslate nohighlight">\(1-\varepsilon\)</span>の確率でQテーブルに基づいた最適な行動を取れば良い。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ランダムに行動する</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">obsrv</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 一番価値が高く見積もられている行動をとる</span>
<span class="n">s0</span> <span class="o">=</span> <span class="n">to_state_index</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>今回は、以下のハイパーパラメータを用いてQ学習を行う。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Q学習のハイパーパラメータ</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">n_episodes</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<p>また、多腕バンディット問題の時と同様に<span class="math notranslate nohighlight">\(\varepsilon\)</span>の値はエピソードが進むごとに徐々に小さい値になるようにスケジューリングしておく。</p>
<p>以下が、<span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法によるQ学習のコードの一例である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">e1</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">e_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">e0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_episodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="n">e0</span>

<span class="c1"># Q値テーブルの初期化</span>
<span class="n">q_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N_DIGITS</span><span class="o">**</span><span class="n">N_INPUTS</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>

<span class="k">for</span> <span class="n">epi</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_episodes</span><span class="p">)):</span>
    <span class="c1"># ゲーム環境のリセット</span>
    <span class="n">obsrv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="c1"># エピソード開始</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># 現在の状態に対応する行番号を計算</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="n">to_state_index</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>

        <span class="c1"># ε-greedy法による行動選択</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="p">:])</span>

        <span class="c1"># 状態の更新</span>
        <span class="n">obsrv</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># 新たな状態に対する行番号を計算</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">to_state_index</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>

        <span class="c1"># Qテーブルの更新</span>
        <span class="n">q0</span> <span class="o">=</span> <span class="n">q_table</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>
        <span class="n">best_q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">q_table</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">q0</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">reward</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">best_q1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="c1"># epsilonの更新</span>
    <span class="n">epsilon</span> <span class="o">*=</span> <span class="n">e_scale</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "c0d7374167874ff59ac0ad66314a6c82"}</script></div>
</div>
<p>学習が終了したら、実行フェーズにおいては、常にQテーブルに基づいて最適な行動を取ることとする。</p>
<p>状態の画像を保存しつつ、学習結果に基づいて行動をするコードは以下の通りである。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">obsrv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="c1"># 最もQ値の高い行動を選択</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">to_state_index</span><span class="p">(</span><span class="n">obsrv</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">s0</span><span class="p">,</span> <span class="p">:])</span>

    <span class="n">obsrv</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># アニメーションの描画</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="c1"># 各フレームの描画</span>
<span class="n">draw</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;frame #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ims</span><span class="p">,</span> <span class="n">txt</span><span class="p">])</span>

<span class="c1"># アニメーションの作成</span>
<span class="n">ani</span> <span class="o">=</span> <span class="n">ArtistAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">ani</span><span class="o">.</span><span class="n">to_html5_video</span><span class="p">())</span>
<span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

<span class="c1"># Matplotlibのウィンドウを閉じる</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><video width="640" height="480" controls autoplay loop>
  <source type="video/mp4" src="data:video/mp4;base64,AAAAIGZ0eXBNNFYgAAACAE00ViBpc29taXNvMmF2YzEAAAAIZnJlZQAANGttZGF0AAACrgYF//+q
3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2MyByMzA2MCA1ZGI2YWE2IC0gSC4yNjQvTVBF
Ry00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMSAtIGh0dHA6Ly93d3cudmlkZW9sYW4u
b3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFs
eXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVk
X3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBk
ZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTYg
bG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRl
cmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJf
cHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9
MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEwIHNjZW5lY3V0PTQwIGludHJhX3Jl
ZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAu
NjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAF
SGWIhAAR//73iB8yy2n5OtdyEeetLq0fUO5GcV6kvf4gAAADAAADAABlQN8pUH95cNzgAAAE8AC6
hI0F/gtX+ID9XvlWyqSgZCWiIjzIIyfgWgRUAUQKEL++XDpwzYLO23ANSIuSS40yX94eU3b3HoCQ
fKZIxfzFCTWtRVNIzCYKdiE3gsQUICbD6KyaM2Xg0DR5gW0pZhFlrrD/rU7UfftTuwG4lbdXEV03
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
ZHRzAAAAHGVsc3QAAAAAAAAAAQAAGcgAAAgAAAEAAAAABOxtZGlhAAAAIG1kaGQAAAAAAAAAAAAA
AAAAACgAAAEIAFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxl
cgAAAASXbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAA
DHVybCAAAAABAAAEV3N0YmwAAAC3c3RzZAAAAAAAAAABAAAAp2F2YzEAAAAAAAAAAQAAAAAAAAAA
AAAAAAAAAAACgAHgAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAY//8AAAA1YXZjQwFkABb/4QAYZ2QAFqzZQKA9oQAAAwABAAADABQPFi2WAQAGaOvjyyLA/fj4
AAAAABx1dWlka2hA8l8kT8W6OaUbzwMj8wAAAAAAAAAYc3R0cwAAAAAAAAABAAAAQgAABAAAAAAU
c3RzcwAAAAAAAAABAAAAAQAAAiBjdHRzAAAAAAAAAEIAAAABAAAIAAAAAAEAABQAAAAAAQAACAAA
AAABAAAAAAAAAAEAAAQAAAAAAQAAFAAAAAABAAAIAAAAAAEAAAAAAAAAAQAABAAAAAABAAAUAAAA
AAEAAAgAAAAAAQAAAAAAAAABAAAEAAAAAAEAABQAAAAAAQAACAAAAAABAAAAAAAAAAEAAAQAAAAA
AQAADAAAAAABAAAEAAAAAAEAABQAAAAAAQAACAAAAAABAAAAAAAAAAEAAAQAAAAAAQAAFAAAAAAB
AAAIAAAAAAEAAAAAAAAAAQAABAAAAAABAAAUAAAAAAEAAAgAAAAAAQAAAAAAAAABAAAEAAAAAAEA
ABQAAAAAAQAACAAAAAABAAAAAAAAAAEAAAQAAAAAAQAAFAAAAAABAAAIAAAAAAEAAAAAAAAAAQAA
BAAAAAABAAAUAAAAAAEAAAgAAAAAAQAAAAAAAAABAAAEAAAAAAEAAAwAAAAAAQAABAAAAAABAAAU
AAAAAAEAAAgAAAAAAQAAAAAAAAABAAAEAAAAAAEAABQAAAAAAQAACAAAAAABAAAAAAAAAAEAAAQA
AAAAAQAAFAAAAAABAAAIAAAAAAEAAAAAAAAAAQAABAAAAAABAAAUAAAAAAEAAAgAAAAAAQAAAAAA
AAABAAAEAAAAAAEAABQAAAAAAQAACAAAAAABAAAAAAAAAAEAAAQAAAAAAQAACAAAAAAcc3RzYwAA
AAAAAAABAAAAAQAAAEIAAAABAAABHHN0c3oAAAAAAAAAAAAAAEIAAAf+AAABFAAAAG4AAABaAAAA
dwAAAQUAAACPAAAAbwAAAHQAAAFrAAAAaQAAAGIAAABmAAABXgAAAH4AAAB6AAAAZQAAAPsAAABb
AAABrwAAAIcAAABaAAAAZgAAASgAAACGAAAAbQAAAGAAAAHWAAAArAAAAHIAAABzAAABPAAAAIUA
AABkAAAAaQAAAVkAAAB/AAAAdAAAAGQAAAFcAAAAeQAAAGAAAABhAAAAxgAAAHIAAAE4AAAAiQAA
AGYAAAB1AAAB1AAAAKcAAABzAAAAdAAAAMQAAACpAAAAjAAAAJcAAAFZAAAAuQAAAJ8AAAB7AAAA
1AAAAJ4AAACPAAAAnwAAALAAAAAUc3RjbwAAAAAAAAABAAAAMAAAAGJ1ZHRhAAAAWm1ldGEAAAAA
AAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRh
AAAAAQAAAABMYXZmNTguNzYuMTAw
">
  Your browser does not support the video tag.
</video></div></div>
</div>
<p>今回は<span class="output text_plain">10000</span>エピソードしか学習を行なっていないが、それでもランダムの時と比較して、かなり長い時間に渡り振子を倒れないようにキープできていることが分かる。</p>
<p>エピソードの数を増やしたり、<span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法以外の方法を用いた場合に、どのように学習結果が変化するかについては、ぜひ自信でコードを修正して試してみてほしい。</p>
</section>
</section>
<section id="id6">
<h2><span class="section-number">2.4. </span>練習問題<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>CartPole環境において、<span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法の部分をソフトマックス探索やUCB1値を用いた探索に置き換えて、学習の性能がどのように変化するかを調べよ。</p></li>
<li><p>CartPole環境は1フレームごとに報酬として常に1を返してくるが、この値を画面中央にCartがある場合に高い値になるように更新することで、できる限り画面の内側で振子を保つように学習方法を変更せよ。</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./contents/sec3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="reinforcement-learning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">前へ</p>
        <p class="prev-next-title"><span class="section-number">1. </span>強化学習の基礎</p>
      </div>
    </a>
    <a class="right-next"
       href="othello-agent.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">次へ</p>
        <p class="prev-next-title"><span class="section-number">3. </span>オセロAIの作成</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目次
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1. 背景</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.2. アルゴリズム</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.3. 倒立振子のバランシング</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2.3.1. ランダムな行動選択</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">2.3.2. Q学習による行動選択</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#varepsilon-greedyq">2.3.3. <span class="math notranslate nohighlight">\(\varepsilon\)</span>-greedy法によるQテーブルの更新</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">2.4. 練習問題</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
著者 Tatsuya Yatagawa
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CC BY-NC-SA 4.0, 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>